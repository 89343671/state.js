function initStateJS(i){function e(r){if(r.length===1){return r[0]}throw"initial pseudo states must have one and only one outbound transition"}function c(r){var s=r.filter(function(t){return t.guard()});if(s.length>1){return s[(s.length-1)*Math.random()]}if(s.length===0){s=r.filter(function(t){return t.isElse})}if(s.length===1){return s[0]}throw"choice pseudo state has no valid outbound transition"}function k(r){var s=r.filter(function(t){return t.guard()});if(s.length>1){throw"junction pseudo state has multiple outbound transitions"}if(s.length===0){s=r.filter(function(t){return t.isElse})}if(s.length===1){return s[0]}throw"junction pseudo state has no valid outbound transition"}function b(s,r,t){if(!s.active){s.active=[]}s.active[r]=t}function m(s,r){if(s.active){return s.active[r]}}function g(s,r,t){if(!s.current){s.current=[]}s.current[r]=t}function l(s,r){if(s.current){return s.current[r]}}function q(r){return r.owner?q(r.owner).concat(r):[r]}var h={Choice:{isInitial:false,isHistory:false,completions:c},DeepHistory:{isInitial:true,isHistory:true,completions:e},Initial:{isInitial:true,isHistory:false,completions:e},Junction:{isInitial:false,isHistory:false,completions:k},ShallowHistory:{isInitial:true,isHistory:true,completions:e},Terminate:{isInitial:false,isHistory:false,completions:null}};function f(s,t,r){this.name=s;this.kind=t;this.owner=r;this.completions=[];if(this.kind.isInitial){this.owner.initial=this}}f.prototype.onExit=function(r){console.log("Leave: "+this.toString());b(r,this,false)};f.prototype.onEnter=function(r){if(m(r,this)){this.onExit(r)}console.log("Enter: "+this.toString());b(r,this,true);if(this.kind===h.Terminated){r.isTerminated=true}};f.prototype.onComplete=function(t,s){var r=this.kind.completions(this.completions);if(r){r.traverse(t,s)}};f.prototype.toString=function(){return this.owner?this.owner+"."+this.name:this.name};function p(s,r){this.name=s;this.owner=r;this.completions=[];this.transitions=[]}p.prototype.isComplete=function(r){return true};p.prototype.onExit=function(r){if(this.exit){this.exit.forEach(function(s){s()})}console.log("Leave: "+this.toString());b(r,this,false)};p.prototype.onEnter=function(r){if(m(r,this)){this.onExit(r)}console.log("Enter: "+this.toString());b(r,this,true);if(this.owner){g(r,this.owner,this)}if(this.entry){this.entry.forEach(function(s){s()})}};p.prototype.onComplete=function(t,r){if(this.completions){if(this.isComplete(t)){var s=this.completions.filter(function(u){return u.guard()});if(s.length===1){s[0].traverse(t,r)}}}};p.prototype.process=function(s,t){if(s.isTerminated){return false}var r=this.transitions.filter(function(u){return u.guard(t)});if(r.length!==1){if(r.length===0){return false}throw"more than one transition found for message: "+t.toString()}r[0].traverse(s,t);return true};p.prototype.toString=function(){return this.owner?this.owner+"."+this.name:this.name};function n(s,r){p.call(this,s,r)}n.prototype=new p();n.prototype.constructor=n;n.prototype.isComplete=function(r){return r.isTerminated||l(r,this).isFinalState};n.prototype.initialise=function(r){this.onEnter(r);this.onComplete(r,false)};n.prototype.onExit=function(r){var s=l(r,this);if(s){s.onExit(r)}p.prototype.onExit.call(this,r)};n.prototype.onComplete=function(s,r){var t=(r||this.initial.kind.isHistory?l(s,this):this.initial)||this.initial;t.onEnter(s);t.onComplete(s,r||this.initial.kind===h.DeepHistory);p.prototype.onComplete.call(this,s,r)};n.prototype.process=function(r,s){if(r.isTerminated){return false}return p.prototype.process.call(this,r,s)||l(r,this).process(r,s)};function a(s,r){p.call(this,s,r);this.regions=[]}a.prototype=new p();a.prototype.constructor=a;a.prototype.isComplete=function(r){return r.isTerminated||this.regions.every(function(s){return s.isComplete(r)})};a.prototype.onExit=function(r){this.regions.forEach(function(s){if(m(r,s)){s.onExit(r)}});p.prototype.onExit.call(this,r)};a.prototype.onComplete=function(s,r){this.regions.forEach(function(t){t.onEnter(s);t.onComplete(s,r)});p.prototype.onComplete.call(this,s,r)};a.prototype.process=function(r,s){if(r.isTerminated){return false}return p.prototype.process.call(this,r,s)||this.regions.reduce(function(t,u){return u.process(r,s)||t},false)};function d(s,r){p.call(this,s,r);this.isFinalState=true}d.prototype=new p();d.prototype.constructor=d;delete d.prototype.comlpetions;delete d.prototype.transitions;d.prototype.process=function(r,s){return false};function o(s,r){this.name=s;this.owner=r;this.initial=null;if(this.owner){this.owner.regions.push(this)}}o.prototype.isComplete=function(r){return r.isTerminated||l(r,this).isFinalState};o.prototype.initialise=function(r){this.onEnter(r);this.onComplete(r,false)};o.prototype.onExit=function(r){var s=l(r,this);if(s){s.onExit(r)}console.log("Leave: "+this.toString());b(r,this,false)};o.prototype.onEnter=function(r){if(m(r,this)){this.onExit(r)}console.log("Enter: "+this.toString());b(r,this,true)};o.prototype.onComplete=function(s,r){var t=(r||this.initial.kind.isHistory?l(s,this):this.initial)||this.initial;t.onEnter(s);t.onComplete(s,r||this.initial.kind===h.DeepHistory)};o.prototype.process=function(r,s){if(r.isTerminated){return false}return m(r,this)&&l(r,this).process(r,s)};o.prototype.toString=function(){return this.owner?this.owner+"."+this.name:this.name};function j(t,u,s){this.target=u;this.guard=s||function(x){return true};if(u){var w=q(t),v=q(u),r=w.length-1;if(t!==u){r=0;while(r<w.length&&r<v.length&&w[r]===v[r]){r=r+1}}this.onExit=[w[r]];if(t.kind&&w[r]!==t){this.onExit.unshift(t)}this.onEnter=v.slice(r)}t[s&&s.length>0?"transitions":"completions"].push(this)}j.prototype.traverse=function(r,s){if(this.onExit){this.onExit.forEach(function(t){t.onExit(r)})}if(this.effect){this.effect.forEach(function(t){t(s)})}if(this.onEnter){this.onEnter.forEach(function(t){t.onEnter(r)})}if(this.target){this.target.onComplete(r,false)}};j.Else=function(r,s){j.call(this,r,s,function(){return false});this.isElse=true};j.Else.prototype=j.prototype;j.Else.prototype.constructor=j.Else;i.PseudoStateKind=h;i.PseudoState=f;i.SimpleState=p;i.CompositeState=n;i.OrthogonalState=a;i.FinalState=d;i.Region=o;i.Transition=j}if(this.exports){initStateJS(this.exports)}else{if(this.define){this.define(function(b,a,c){initStateJS(a)})}else{initStateJS(this)}};