!function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require
if(!s&&u)return u(a,!0)
if(r)return r(a,!0)
var c=new Error("Cannot find module '"+a+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=n[a]={exports:{}}
e[a][0].call(h.exports,function(t){var n=e[a][1][t]
return o(n?n:t)},h,h.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a])
return o}({1:[function(t,e){var n
!function(t){!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(t.PseudoStateKind||(t.PseudoStateKind={}))
t.PseudoStateKind}(n||(n={}))
var n
!function(t){!function(t){t[t.Internal=0]="Internal",t[t.Local=1]="Local",t[t.External=2]="External"}(t.TransitionKind||(t.TransitionKind={}))
t.TransitionKind}(n||(n={}))
var n
!function(t){var e=function(){function t(t,e){this.name=t,this.qualifiedName=e?e.qualifiedName+"."+t:t}return t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
t.Element=e}(n||(n={}))
var n,i=this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])
n.prototype=e.prototype,t.prototype=new n}
!function(t){var e=function(e){function n(t,n){e.call(this,t,n),this.vertices=[],this.state=n,this.state.regions.push(this),this.state.getRoot().clean=!1}return i(n,e),n.prototype.getRoot=function(){return this.state.getRoot()},n.prototype.getInitial=function(){var e
return this.vertices.forEach(function(n){n instanceof t.PseudoState&&n.isInitial()&&(e=n)}),e},n.prototype.accept=function(t,e,n,i){return t.visitRegion(this,e,n,i)},n.defaultName="default",n}(t.Element)
t.Region=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(n,i){e.call(this,n,i=i instanceof t.State?i.defaultRegion():i),this.outgoing=[],(this.region=i)&&(this.region.vertices.push(this),this.region.getRoot().clean=!1)}return i(n,e),n.prototype.getRoot=function(){return this.region.getRoot()},n.prototype.to=function(e,n){return void 0===n&&(n=t.TransitionKind.External),new t.Transition(this,e,n)},n.prototype.accept=function(){},n}(t.Element)
t.Vertex=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(n,i,o){void 0===o&&(o=t.PseudoStateKind.Initial),e.call(this,n,i),this.kind=o}return i(n,e),n.prototype.isHistory=function(){return this.kind===t.PseudoStateKind.DeepHistory||this.kind===t.PseudoStateKind.ShallowHistory},n.prototype.isInitial=function(){return this.kind===t.PseudoStateKind.Initial||this.isHistory()},n.prototype.accept=function(t,e,n,i){return t.visitPseudoState(this,e,n,i)},n}(t.Vertex)
t.PseudoState=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(t,n){e.call(this,t,n),this.exitBehavior=[],this.entryBehavior=[],this.regions=[]}return i(n,e),n.prototype.defaultRegion=function(){var e
return this.regions.forEach(function(n){n.name===t.Region.defaultName&&(e=n)}),e||(e=new t.Region(t.Region.defaultName,this)),e},n.prototype.isFinal=function(){return 0===this.outgoing.length},n.prototype.isSimple=function(){return 0===this.regions.length},n.prototype.isComposite=function(){return this.regions.length>0},n.prototype.isOrthogonal=function(){return this.regions.length>1},n.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},n.prototype.entry=function(t){return this.entryBehavior.push(t),this.getRoot().clean=!1,this},n.prototype.accept=function(t,e,n,i){return t.visitState(this,e,n,i)},n}(t.Vertex)
t.State=e}(n||(n={}))
var n
!function(t){var e=function(t){function e(e,n){t.call(this,e,n)}return i(e,t),e.prototype.accept=function(t,e,n,i){return t.visitFinalState(this,e,n,i)},e}(t.State)
t.FinalState=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(n){e.call(this,n,void 0),this.clean=!1,this.logTo=t.defaultConsole,this.warnTo=t.defaultConsole,this.errorTo=t.defaultConsole}return i(n,e),n.prototype.getRoot=function(){return this.region?this.region.getRoot():this},n.prototype.setLogger=function(t){return this.logTo=t,this.clean=!1,this},n.prototype.setWarning=function(t){return this.warnTo=t,this.clean=!1,this},n.prototype.setError=function(t){return this.errorTo=t,this.clean=!1,this},n.prototype.accept=function(t,e,n,i){return t.visitStateMachine(this,e,n,i)},n}(t.State)
t.StateMachine=e,t.defaultConsole={log:function(){},warn:function(){},error:function(t){throw t}}}(n||(n={}))
var n
!function(t){var e=function(){function e(n,i,o){var r=this
void 0===o&&(o=t.TransitionKind.External),this.source=n,this.target=i,this.transitionBehavior=[],this.onTraverse=[],this.guard=n instanceof t.PseudoState?e.TrueGuard:function(t){return t===r.source},this.kind=i?o:t.TransitionKind.Internal,this.source.outgoing.push(this),this.source.getRoot().clean=!1}return e.prototype["else"]=function(){return this.guard=e.FalseGuard,this},e.prototype.when=function(t){return this.guard=t,this},e.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.getRoot().clean=!1,this},e.prototype.accept=function(t,e,n,i){return t.visitTransition(this,e,n,i)},e.prototype.toString=function(){return"["+(this.target?this.source+" -> "+this.target:this.source)+"]"},e.TrueGuard=function(){return!0},e.FalseGuard=function(){return!1},e}()
t.Transition=e}(n||(n={}))
var n
!function(t){var e=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,e,n,i){var o=this,r=this.visitElement(t,e,n,i)
return t.vertices.forEach(function(t){t.accept(o,e,n,i)}),r},t.prototype.visitVertex=function(t,e,n,i){var o=this,r=this.visitElement(t,e,n,i)
return t.outgoing.forEach(function(t){t.accept(o,e,n,i)}),r},t.prototype.visitPseudoState=function(t,e,n,i){return this.visitVertex(t,e,n,i)},t.prototype.visitState=function(t,e,n,i){var o=this,r=this.visitVertex(t,e,n,i)
return t.regions.forEach(function(t){t.accept(o,e,n,i)}),r},t.prototype.visitFinalState=function(t,e,n,i){return this.visitState(t,e,n,i)},t.prototype.visitStateMachine=function(t,e,n,i){return this.visitState(t,e,n,i)},t.prototype.visitTransition=function(){},t}()
t.Visitor=e}(n||(n={}))
var n
!function(t){var e=function(){function t(t){void 0===t&&(t="unnamed"),this.name=t,this.last={},this.isTerminated=!1}return t.prototype.setCurrent=function(t,e){this.last[t.qualifiedName]=e},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
t.StateMachineInstance=e}(n||(n={}))
var n
!function(t){function e(t){i=t}function n(){return i}t.setRandom=e,t.getRandom=n
var i=function(t){return Math.floor(Math.random()*t)}}(n||(n={}))
var n
!function(t){function e(n,i){return n instanceof t.Region?e(n.state,i):n instanceof t.State?n.region?e(n.region,i)&&i.getCurrent(n.region)===n:!0:void 0}t.isActive=e}(n||(n={}))
var n
!function(t){function e(n,i){return n instanceof t.Region?i.getCurrent(n).isFinal():n instanceof t.State?n.regions.every(function(t){return e(t,i)}):!0}t.isComplete=e}(n||(n={}))
var n
!function(t){function e(t){t.accept(new p)}function n(t,e,i){void 0===i&&(i=!0),e?(i&&t.clean===!1&&n(t),t.logTo.log("initialise "+e),t.onInitialise.forEach(function(t){return t(void 0,e)})):(t.logTo.log("initialise "+t.name),t.accept(new f,!1),t.clean=!0)}function o(t,e,i,o){return void 0===o&&(o=!0),t.logTo.log(e+" evaluate "+i),o&&t.clean===!1&&n(t),e.isTerminated?!1:r(t,e,i)}function r(e,n,i){var o=!1
if(e.regions.every(function(a){return r(n.getCurrent(a),n,i)&&(o=!0,!t.isActive(e,n))?!1:!0}),o)i!==e&&t.isComplete(e,n)&&r(e,n,e)
else{var s
e.outgoing.forEach(function(t){t.guard(i,n)&&(s&&e.getRoot().errorTo.error("Multiple outbound transitions evaluated true"),s=t)}),s&&(o=a(s,n,i))}return o}function a(e,n,i){for(var o=e.onTraverse,u=e.target;u&&u instanceof t.PseudoState&&u.kind===t.PseudoStateKind.Junction;)u instanceof t.PseudoState&&(e=s(u,n,i)),u=e.target,Array.prototype.push.apply(o,e.onTraverse)
return o.forEach(function(t){return t(i,n)}),u&&u instanceof t.PseudoState&&u.kind===t.PseudoStateKind.Choice?a(s(u,n,i),n,i):u&&u instanceof t.State&&t.isComplete(u,n)&&r(u,n,u),!0}function s(e,n,i){var o,r=this,a=[]
return e.outgoing.forEach(function(s){s.guard===t.Transition.FalseGuard?(o&&e.getRoot().errorTo.error("Multiple outbound else transitions found at "+r+" for "+i),o=s):s.guard(i,n)&&a.push(s)}),e.kind===t.PseudoStateKind.Choice?0!==a.length?a[t.getRandom()(a.length)]:o:e.kind===t.PseudoStateKind.Junction?(a.length>1&&e.getRoot().errorTo.error("Multiple outbound transition guards returned true at "+this+" for "+i),a[0]||o):void 0}function u(t){return(t.region?u(t.region.state).concat(t.region):[]).concat(t)}t.validate=e,t.initialise=n,t.evaluate=o
var c=function(){function t(){this.leave=[],this.beginEnter=[],this.endEnter=[],this.enter=[]}return t}(),h=function(e){function n(){e.apply(this,arguments)}return i(n,e),n.prototype.visitTransition=function(e,n){switch(e.kind){case t.TransitionKind.Internal:e.onTraverse=e.transitionBehavior
break
case t.TransitionKind.Local:this.visitLocalTransition(e,n)
break
case t.TransitionKind.External:this.visitExternalTransition(e,n)}},n.prototype.visitLocalTransition=function(e,n){var i=this
e.onTraverse.push(function(o,r){for(var a=u(e.target),s=0;t.isActive(a[s],r);)s++
var c=a[s]
for(c instanceof t.Vertex?n[r.getCurrent(c.region).qualifiedName].leave.forEach(function(t){return t(o,r)}):c instanceof t.Region&&n[r.getCurrent(c).qualifiedName].leave.forEach(function(t){return t(o,r)}),e.transitionBehavior.forEach(function(t){return t(o,r)});s<a.length;)i.cascadeElementEntry(e,n,a[s++],s<a.length?a[s]:void 0,function(t){t.forEach(function(t){return t(o,r)})})
n[e.target.qualifiedName].endEnter.forEach(function(t){return t(o,r)})})},n.prototype.visitExternalTransition=function(t,e){for(var n=u(t.source),i=u(t.target),o=Math.min(n.length,i.length)-1;n[o-1]!==i[o-1];)o--
for(Array.prototype.push.apply(t.onTraverse,e[n[o].qualifiedName].leave),Array.prototype.push.apply(t.onTraverse,t.transitionBehavior);o<i.length;)this.cascadeElementEntry(t,e,i[o++],i[o],function(e){Array.prototype.push.apply(t.onTraverse,e)})
Array.prototype.push.apply(t.onTraverse,e[t.target.qualifiedName].endEnter)},n.prototype.cascadeElementEntry=function(e,n,i,o,r){r(n[i.qualifiedName].beginEnter),o&&i instanceof t.State&&i.isOrthogonal()&&i.regions.forEach(function(t){t!==o&&r(n[t.qualifiedName].enter)})},n}(t.Visitor),f=function(e){function n(){e.apply(this,arguments),this.behaviours={}}return i(n,e),n.prototype.behaviour=function(t){return this.behaviours[t.qualifiedName]||(this.behaviours[t.qualifiedName]=new c)},n.prototype.visitRegion=function(e,n){var i=this,o=this.behaviour(e),r=e.getInitial()
e.vertices.forEach(function(e){return e.accept(i,n||r&&r.kind===t.PseudoStateKind.DeepHistory)}),o.leave.push(function(t,n){return i.behaviour(n.getCurrent(e)).leave.forEach(function(e){return e(t,n)})}),n||!r||r.isHistory()?o.endEnter.push(function(n,o,a){i.behaviour(a||r.isHistory()?o.getCurrent(e)||r:r).enter.forEach(function(e){return e(n,o,a||r.kind===t.PseudoStateKind.DeepHistory)})}):Array.prototype.push.apply(o.endEnter,this.behaviour(r).enter),e.getRoot().logTo!==t.defaultConsole&&(o.leave.push(function(t,n){return e.getRoot().logTo.log(n+" leave "+e)}),o.beginEnter.push(function(t,n){return e.getRoot().logTo.log(n+" enter "+e)})),o.enter=o.beginEnter.concat(o.endEnter)},n.prototype.visitVertex=function(e){if(e.getRoot().logTo!==t.defaultConsole){var n=this.behaviour(e)
n.leave.push(function(t,n){return e.getRoot().logTo.log(n+" leave "+e)}),n.beginEnter.push(function(t,n){return e.getRoot().logTo.log(n+" enter "+e)})}},n.prototype.visitPseudoState=function(e,n){var i=this.behaviour(e)
this.visitVertex(e,n),e.isInitial()?this.behaviour(e).endEnter.push(function(t,n){return a(e.outgoing[0],n)}):e.kind===t.PseudoStateKind.Terminate&&i.beginEnter.push(function(t,e){return e.isTerminated=!0}),i.enter=i.beginEnter.concat(i.endEnter)},n.prototype.visitState=function(t,e){var n=this,i=this.behaviour(t)
t.regions.forEach(function(t){var o=n.behaviour(t)
t.accept(n,e),Array.prototype.push.apply(i.leave,o.leave),Array.prototype.push.apply(i.endEnter,o.enter)}),this.visitVertex(t,e),Array.prototype.push.apply(i.leave,t.exitBehavior),Array.prototype.push.apply(i.beginEnter,t.entryBehavior),i.beginEnter.push(function(e,n){t.region&&n.setCurrent(t.region,t)}),i.enter=i.beginEnter.concat(i.endEnter)},n.prototype.visitStateMachine=function(t,e){this.visitState(t,e),t.accept(new h,this.behaviours),t.onInitialise=this.behaviour(t).enter},n}(t.Visitor),p=function(e){function n(){e.apply(this,arguments)}return i(n,e),n.prototype.visitPseudoState=function(n){e.prototype.visitPseudoState.call(this,n),n.isInitial()?1!==n.outgoing.length?n.getRoot().errorTo.error(n+": initial pseudo states must have one outgoing transition."):n.outgoing[0].guard!==t.Transition.TrueGuard&&n.getRoot().errorTo.error(n+": initial pseudo states cannot have a guard condition."):(n.kind===t.PseudoStateKind.Choice||n.kind===t.PseudoStateKind.Junction)&&0===n.outgoing.length&&n.getRoot().errorTo.error(n+": "+n.kind+" pseudo states must have at least one outgoing transition.")},n.prototype.visitRegion=function(n){e.prototype.visitRegion.call(this,n)
var i
n.vertices.forEach(function(e){e instanceof t.PseudoState&&e.isInitial()&&(i&&n.getRoot().errorTo.error(n+": regions may have at most one initial pseudo state."),i=e)})},n.prototype.visitFinalState=function(t){e.prototype.visitFinalState.call(this,t),0!==t.outgoing.length&&t.getRoot().errorTo.error(t+": final states must not have outgoing transitions."),0!==t.regions.length&&t.getRoot().errorTo.error(t+": final states must not have child regions."),0!==t.entryBehavior.length&&t.getRoot().warnTo.warn(t+": final states may not have entry behavior."),0!==t.exitBehavior.length&&t.getRoot().warnTo.warn(t+": final states may not have exit behavior.")},n.prototype.visitTransition=function(n){e.prototype.visitTransition.call(this,n),n.kind===t.TransitionKind.Local&&-1===u(n.target).indexOf(n.source)&&n.source.getRoot().errorTo.error(n+": local transition target vertices must be a child of the source composite sate.")},n}(t.Visitor)}(n||(n={}))
var e=e
e.exports=n},{}],2:[function(t){!function(e){var n=document.currentScript
if(!n){var i=document.getElementsByTagName("script")
n=i[i.length-1]}e[n.attributes.target?n.attributes.target.textContent:"fsm"]=t("../lib/state.com.js")}(window)},{"../lib/state.com.js":1}]},{},[2])
