!function t(e,i,n){function r(a,s){if(!i[a]){if(!e[a]){var u="function"==typeof require&&require
if(!s&&u)return u(a,!0)
if(o)return o(a,!0)
var c=new Error("Cannot find module '"+a+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=i[a]={exports:{}}
e[a][0].call(h.exports,function(t){var i=e[a][1][t]
return r(i?i:t)},h,h.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a])
return r}({1:[function(t,e,i){function n(t,e,i){void 0===i&&(i=!0),e?(i&&t.clean===!1&&n(t),t.logger&&t.logger.log("initialise "+e),a(t.onInitialise,void 0,e)):(t.logger&&t.logger.log("initialise "+t.name),t.accept(new R,!1),t.clean=!0)}function r(t,e,i,r){return void 0===r&&(r=!0),t.logger&&t.logger.log(e+" evaluate "+i),r&&t.clean===!1&&n(t),e.isTerminated?!1:t.accept(S.instance,e,i)}function o(t,e){return t instanceof v?t.regions.every(function(t){return e.getCurrent(t).isFinal()}):!0}function a(t,e,i,n){void 0===n&&(n=!1),t.forEach(function(t){t(e,i,n)})}function s(t,e){return t.region?s(t.region.state,e)&&e.getCurrent(t.region)===t:!0}var u=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])
i.prototype=e.prototype,t.prototype=new i}
!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(i.PseudoStateKind||(i.PseudoStateKind={}))
var c=i.PseudoStateKind,h=function(){function t(t){this.name=t}return t.prototype.getParent=function(){},t.prototype.getRoot=function(){return this.getParent().getRoot()},t.prototype.ancestors=function(){return(this.getParent()?this.getParent().ancestors():[]).concat(this)},t.prototype.accept=function(){},t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
i.Element=h
var f=function(t){function e(e,i){t.call(this,e),this.vertices=[],this.state=i,this.state.regions.push(this),this.state.getRoot().clean=!1}return u(e,t),e.prototype.getParent=function(){return this.state},e.prototype.accept=function(t,e,i,n,r){return t.visitRegion(this,e,i,n,r)},e.defaultName="default",e}(h)
i.Region=f
var p=function(t){function e(e,i){t.call(this,e),this.transitions=[],i instanceof f?this.region=i:i instanceof v&&(this.region=i.defaultRegion()),this.region&&(this.region.vertices.push(this),this.region.getRoot().clean=!1)}return u(e,t),e.prototype.getParent=function(){return this.region},e.prototype.to=function(t){var e=new y(this,t)
return this.transitions.push(e),this.getRoot().clean=!1,e},e}(h)
i.Vertex=p
var l=function(t){function e(e,i,n){t.call(this,e,i),this.kind=n,this.isInitial()&&(this.region.initial=this)}return u(e,t),e.prototype.isHistory=function(){return this.kind===c.DeepHistory||this.kind===c.ShallowHistory},e.prototype.isInitial=function(){return this.kind===c.Initial||this.isHistory()},e.prototype.accept=function(t,e,i,n,r){return t.visitPseudoState(this,e,i,n,r)},e}(p)
i.PseudoState=l
var v=function(t){function e(e,i){t.call(this,e,i),this.exitBehavior=[],this.entryBehavior=[],this.regions=[]}return u(e,t),e.prototype.defaultRegion=function(){var t
return this.regions.forEach(function(e){e.name===f.defaultName&&(t=e)}),t||(t=new f(f.defaultName,this)),t},e.prototype.isFinal=function(){return 0===this.transitions.length},e.prototype.isSimple=function(){return 0===this.regions.length},e.prototype.isComposite=function(){return this.regions.length>0},e.prototype.isOrthogonal=function(){return this.regions.length>1},e.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},e.prototype.entry=function(t){return this.entryBehavior.push(t),this.getRoot().clean=!1,this},e.prototype.accept=function(t,e,i,n,r){return t.visitState(this,e,i,n,r)},e}(p)
i.State=v
var g=function(t){function e(e,i){t.call(this,e,i)}return u(e,t),e.prototype.to=function(){throw"A FinalState cannot be the source of a transition."},e.prototype.accept=function(t,e,i,n,r){return t.visitFinalState(this,e,i,n,r)},e}(v)
i.FinalState=g
var d=function(t){function e(e){t.call(this,e,void 0),this.clean=!1}return u(e,t),e.prototype.getRoot=function(){return this.region?this.region.getRoot():this},e.prototype.setLogger=function(t){return void 0===t&&(t=void 0),this.logger=t,this.clean=!1,this},e.prototype.accept=function(t,e,i,n,r){return t.visitStateMachine(this,e,i,n,r)},e}(v)
i.StateMachine=d
var y=function(){function t(t,e){var i=this
this.source=t,this.target=e,this.transitionBehavior=[],this.traverse=[],this.guard=function(t){return t===i.source}}return t.prototype["else"]=function(){return this.guard=t.isElse,this},t.prototype.when=function(t){return this.guard=t,this},t.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.getRoot().clean=!1,this},t.prototype.accept=function(t,e,i,n,r){return t.visitTransition(this,e,i,n,r)},t.isElse=function(){return!1},t}()
i.Transition=y
var m=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,e,i,n,r){var o=this,a=this.visitElement(t,e,i,n,r)
return t.vertices.forEach(function(t){t.accept(o,e,i,n,r)}),a},t.prototype.visitVertex=function(t,e,i,n,r){var o=this,a=this.visitElement(t,e,i,n,r)
return t.transitions.forEach(function(t){t.accept(o,e,i,n,r)}),a},t.prototype.visitPseudoState=function(t,e,i,n,r){return this.visitVertex(t,e,i,n,r)},t.prototype.visitState=function(t,e,i,n,r){var o=this,a=this.visitVertex(t,e,i,n,r)
return t.regions.forEach(function(t){t.accept(o,e,i,n,r)}),a},t.prototype.visitFinalState=function(t,e,i,n,r){return this.visitState(t,e,i,n,r)},t.prototype.visitStateMachine=function(t,e,i,n,r){return this.visitState(t,e,i,n,r)},t.prototype.visitTransition=function(){},t}()
i.Visitor=m
var E=function(){function t(t){void 0===t&&(t="unnamed"),this.name=t,this.last={},this.isTerminated=!1}return t.prototype.setCurrent=function(t,e){this.last[t.qualifiedName]=e},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
i.StateMachineInstance=E,i.initialise=n,i.evaluate=r,i.isComplete=o
var b=function(){function t(){this.leave=[],this.beginEnter=[],this.endEnter=[],this.enter=[]}return t}(),S=function(t){function e(){t.apply(this,arguments)}return u(e,t),e.prototype.visitRegion=function(t,e,i){return e.getCurrent(t).accept(this,e,i)},e.prototype.visitPseudoState=function(t,e,i){var n,r=this
switch(t.kind){case c.Initial:case c.DeepHistory:case c.ShallowHistory:if(1!==t.transitions.length)throw"Initial transition must have a single outbound transition from "+t
n=t.transitions[0]
break
case c.Junction:var o,s
t.transitions.forEach(function(t){if(t.guard===y.isElse){if(s)throw"Multiple outbound transitions evaluated true"
s=t}else if(t.guard(i,e)){if(o)throw"Multiple outbound transitions evaluated true"
o=t}}),n=o||s
break
case c.Choice:var u=[]
t.transitions.forEach(function(t){if(t.guard===y.isElse){if(s)throw"Multiple outbound else transitions found at "+r+" for "+i
s=t}else t.guard(i,e)&&u.push(t)}),n=0!==u.length?u[Math.round((u.length-1)*Math.random())]:s}return n?(a(n.traverse,i,e),!0):!1},e.prototype.visitState=function(t,e,i){for(var n=!1,r=0,u=t.regions.length;u>r&&(!t.regions[r].accept(this,e,i)||(n=!0,s(t,e)));r++);if(!n){var c
t.transitions.forEach(function(t){if(t.guard(i,e)){if(c)throw new Error("Multiple outbound transitions evaluated true")
c=t}}),c&&(a(c.traverse,i,e),n=!0)}return n&&i!==t&&o(t,e)&&this.visitState(t,e,t),n},e.instance=new e,e}(m),w=function(t){function e(){t.apply(this,arguments)}return u(e,t),e.prototype.visitTransition=function(t,e){if(t.target)if(t.target.region===t.source.region)t.traverse=e(t.source).leave.concat(t.transitionBehavior).concat(e(t.target).enter)
else{for(var i=t.source.ancestors(),n=t.target.ancestors(),r=i.length,o=n.length,a=0,s=Math.min(r,o);s>a&&i[a]===n[a];)a++
if(i[a]instanceof f)throw"Transitions may not cross sibling orthogonal region boundaries"
for(t.traverse=e(r>a?i[a]:t.source).leave.slice(0),t.traverse=t.traverse.concat(t.transitionBehavior),a>=o&&(t.traverse=t.traverse.concat(e(t.target).beginEnter));o>a;){var u=n[a++],c=o>a?n[a]:void 0
if(t.traverse=t.traverse.concat(e(u).beginEnter),u instanceof v){var h=u
h.isOrthogonal()&&h.regions.forEach(function(i){i!==c&&(t.traverse=t.traverse.concat(e(i).enter))})}}t.traverse=t.traverse.concat(e(t.target).endEnter)}else t.traverse=t.transitionBehavior},e}(m),R=function(t){function e(){t.apply(this,arguments),this.behaviours={}}return u(e,t),e.prototype.behaviour=function(t){return t.qualifiedName||(t.qualifiedName=t.ancestors().map(function(t){return t.name}).join(h.namespaceSeparator)),this.behaviours[t.qualifiedName]||(this.behaviours[t.qualifiedName]=new b)},e.prototype.visitElement=function(t){if(t.getRoot().logger){var e=this.behaviour(t),i=t.getRoot().logger
e.leave.push(function(e,n){i.log(n+" leave "+t)}),e.beginEnter.push(function(e,n){i.log(n+" enter "+t)})}},e.prototype.visitRegion=function(t,e){var i=this,n=this.behaviour(t)
t.vertices.forEach(function(n){n.accept(i,e||t.initial&&t.initial.kind===c.DeepHistory)}),n.leave.push(function(e,n){a(i.behaviour(n.getCurrent(t)).leave,e,n)}),e||!t.initial||t.initial.isHistory()?n.endEnter.push(function(e,n,r){var o=t.initial;(r||t.initial.isHistory())&&(o=n.getCurrent(t)||t.initial),a(i.behaviour(o).enter,e,n,r||t.initial.kind===c.DeepHistory)}):n.endEnter=n.endEnter.concat(this.behaviour(t.initial).enter),this.visitElement(t,e),n.enter=n.beginEnter.concat(n.endEnter)},e.prototype.visitVertex=function(t,e){this.visitElement(t,e),this.behaviour(t).endEnter.push(function(e,i){o(t,i)&&t.accept(S.instance,i,t)})},e.prototype.visitPseudoState=function(t,e){var i=this.behaviour(t)
this.visitVertex(t,e),t.kind===c.Terminate&&i.enter.push(function(t,e){e.isTerminated=!0}),i.enter=i.beginEnter.concat(i.endEnter)},e.prototype.visitState=function(t,e){var i=this,n=this.behaviour(t)
t.regions.forEach(function(t){var r=i.behaviour(t)
t.accept(i,e),n.leave=n.leave.concat(r.leave),n.endEnter=n.endEnter.concat(r.enter)}),this.visitVertex(t,e),n.leave=n.leave.concat(t.exitBehavior),n.beginEnter=n.beginEnter.concat(t.entryBehavior),n.beginEnter.push(function(e,i){t.region&&i.setCurrent(t.region,t)}),n.enter=n.beginEnter.concat(n.endEnter)},e.prototype.visitStateMachine=function(t,e){var i=this
this.visitState(t,e),t.accept(new w,function(t){return i.behaviour(t)}),t.onInitialise=this.behaviour(t).enter},e}(m)},{}],2:[function(t){!function(e){var i=document.currentScript
if(!i){var n=document.getElementsByTagName("script")
i=n[n.length-1]}var r=i.attributes["class"]
e[r?r.textContent:"fsm"]=t("../lib/state.com.js")}(window)},{"../lib/state.com.js":1}]},{},[2])
