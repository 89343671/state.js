<!DOCTYPE html>
<html lang="en">
	<head>
		<title>state.js example</title>
		<script src="../src/oldie.js"></script>
		<script src="../src/state.js"></script>
		<script>
			// create the state machine
			var controller = new Region( "player" );
		
			// create some states
			var initial1 = new PseudoState( PseudoStateKind.Initial, controller );
			var operational = new State( "operational", controller );
			var finalState = new FinalState( "final", controller );
			var initial2 = new PseudoState( PseudoStateKind.Initial, operational );
			var stopped = new State( "stopped", operational );
			var active = new State( "active", operational );		
			var running = new State( "running", active);
			var paused = new State( "paused", active);	
		
			// add some behaviour
			active.Entry.push( EngageHead );
			active.Exit.push( DisengageHead );
			running.Entry.push( StartMotor );
			running.Exit.push( StopMotor );
			
			// create the transitions
			var initialise = new Completion( initial1, operational );
			new Completion( initial2, stopped );
			new Transition( stopped, running, function( s ) { return ( s == "play" ); } );
			new Transition( active, stopped, function( s ) { return s == "stop"; } );
			new Transition( running, paused, function( s ) { return s == "pause"; } );
			new Transition( paused, running, function( s ) { return s == "play"; } );
			new Transition( operational, finalState, function( s ) { return s == "off"; } );

			// add some transition behaviour
			initialise.Effect.push( StopMotor, DisengageHead );
			
			function EngageHead()
			{
				document.getElementById("head").innerHTML = "Head: engaged";
			}
			
			function DisengageHead()
			{
				document.getElementById("head").innerHTML = "Head: disengaged";
			}
			
			function StartMotor()
			{
				document.getElementById("motor").innerHTML = "Motor: running";
			}
			
			function StopMotor()
			{
				document.getElementById("motor").innerHTML = "Motor: stopped";
			}
			
			// a little more behavior to adjust the graphic
			stopped.Entry.push( function() { UpdateGraphic( "controller_stopped.png" ); } );
			running.Entry.push( function() { UpdateGraphic( "controller_running.png" ); } );
			paused.Entry.push( function() { UpdateGraphic( "controller_paused.png" ); } );
			operational.Exit.push( function() { UpdateGraphic( "controller_final.png" ); } );
			
			function UpdateGraphic( uri )
			{
				document.getElementById( "diagram" ).src = uri;
			}
			</script>
	</head>
	<body onload="controller.Initialise()">
		<h1>state.js cassette controller example</h1>
		<p>This example implements a simple controller for a cassette player according to the model below:</p>
		<p><img id="diagram" /></p>
		<p>Press the buttons below to send events to the controller (check brower console for trace output):</p>
		<button type="button" onclick="controller.Process( 'play' )">Play</button>
		<button type="button" onclick="controller.Process( 'pause' )">Pause</button>
		<button type="button" onclick="controller.Process( 'stop' )">Stop</button>
		<button type="button" onclick="controller.Process( 'off' )">Off</button>
		<button type="button" onclick="{ controller.Reset(); controller.Initialise(); }">Reset controller</button>
		<p id="head">Head: </p>
		<p id="motor">Motor: </p>
	</body>
</html>