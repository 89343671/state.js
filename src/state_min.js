function initStateJS(q){function p(x,v){var w,u,t;for(w=0,u=x.length;w<u;w=w+1){if(v(x[w])){if(t){throw"single found more than one result"}t=x[w]}}return t}function r(u,t,v){if(!u.active){u.active=[]}u.active[t]=v}function d(u,t){if(u.active){return u.active[t]}}function g(u,t,v){if(!u.current){u.current=[]}u.current[t]=v}function i(u,t){if(u.current){return u.current[t]}}function e(v,w,t){this.guard=t||function(){return true};if(w&&(w!==null)){var y=v.owner.ancestors(),x=w.owner.ancestors(),u=0;while(y.length>u&&x.length>u&&y[u]===x[u]){u=u+1}this.sourceAncestorsToExit=y.slice(u);this.targetAncestorsToEnter=x.slice(u);this.sourceAncestorsToExit.reverse();this.source=v;this.target=w}v[t&&t.length>0?"transitions":"completions"].push(this)}e.prototype.traverse=function(t,u){if(this.source){this.source.beginExit(t);this.source.endExit(t);this.sourceAncestorsToExit.forEach(function(v){v.endExit(t)})}if(this.effect){this.effect.forEach(function(v){v(u)})}if(this.target){this.targetAncestorsToEnter.forEach(function(v){v.beginEnter(t)});this.target.beginEnter(t);this.target.endEnter(t,false)}};e.Else=function(t,u){e.call(this,t,u,function(){return false})};e.Else.prototype=e.prototype;e.Else.prototype.constructor=e.Else;function o(t){if(t.length===1){return t[0]}throw"initial pseudo states must have one and only one outbound transition"}function a(t){var u=t.filter(function(v){return v.guard()});if(u.length>1){return u[(u.length-1)*Math.random()]}if(u.length===0){u=t.filter(function(v){return v instanceof e.Else})}if(u.length===1){return u[0]}throw"choice pseudo state has no valid outbound transition"}function c(u){var t=p(u,function(v){return v.guard()});if(t){return t}t=p(u,function(v){return v instanceof e.Else});if(t){return t}throw"junction PseudoState has no valid competion transitions"}var f={Choice:{isInitial:false,isHistory:false,completions:a},DeepHistory:{isInitial:true,isHistory:true,completions:o},Initial:{isInitial:true,isHistory:false,completions:o},Junction:{isInitial:false,isHistory:false,completions:c},ShallowHistory:{isInitial:true,isHistory:true,completions:o},Terminate:{isInitial:false,isHistory:false,completions:null}};function l(u,t){this.name=u;this.owner=t}l.prototype.qualifiedName=function(){return this.owner?this.owner+"."+this.name:this.name};l.prototype.ancestors=function(){var t=this.owner?this.owner.ancestors():[];t.push(this);return t};l.prototype.beginExit=function(t){};l.prototype.endExit=function(t){console.log("Leave: "+this.toString());r(t,this,false)};l.prototype.beginEnter=function(t){if(d(t,this)){this.beginExit(t);this.endExit(t)}console.log("Enter: "+this.toString());r(t,this,true)};l.prototype.endEnter=function(u,t){};l.prototype.toString=function(){return this.qualifiedName()};function h(u,v,t){l.call(this,u,t);this.kind=v;this.completions=[];if(this.kind.isInitial){this.owner.initial=this}}h.prototype=new l();h.prototype.constructor=h;h.prototype.endEnter=function(u,t){if(this.kind===f.Terminate){u.IsTerminated=true}else{this.kind.completions(this.completions).traverse(u,t)}};function n(u,t){l.call(this,u,t);this.completions=[];this.transitions=[]}n.prototype=new l();n.prototype.constructor=n;n.prototype.isComplete=function(t){return true};n.prototype.endExit=function(t){if(this.exit){this.exit.forEach(function(u){u()})}l.prototype.endExit.call(this,t)};n.prototype.beginEnter=function(t){l.prototype.beginEnter.call(this,t);if(this.owner){g(t,this.owner,this)}if(this.entry){this.entry.forEach(function(u){u()})}};n.prototype.endEnter=function(v,u){if(this.isComplete(v)){var t=p(this.completions,function(w){return w.guard()});if(t){t.traverse(v,u)}}};n.prototype.process=function(u,v){var t=p(this.transitions,function(w){return w.guard(v)});if(!t){return false}t.traverse(u,v);return true};function j(u,t){n.call(this,u,t)}j.prototype=new n();j.prototype.constructor=j;j.prototype.isComplete=function(t){var u=i(t,this);return t.isTerminated||u===null||u.isFinalState||d(t,u)===false};j.prototype.beginExit=function(t){var u=i(t,this);if(u){u.beginExit(t);u.endExit(t)}};j.prototype.endEnter=function(u,t){var v=(t||this.initial.kind.isHistory?i(u,this):this.initial)||this.initial;v.beginEnter(u);v.endEnter(u,t||this.initial.kind===f.DeepHistory);n.prototype.endEnter.call(this,u,t)};j.prototype.process=function(t,u){return n.prototype.process.call(this,t,u)||i(t,this).process(t,u)};function s(u,t){n.call(this,u,t);this.regions=[]}s.prototype=new n();s.prototype.constructor=s;s.prototype.isComplete=function(t){return t.isTerminated||this.regions.every(function(u){return u.isComplete(t)})};s.prototype.beginExit=function(t){this.regions.forEach(function(u){if(d(t,u)){u.beginExit(t);u.endExit(t)}})};s.prototype.endEnter=function(u,t){this.regions.forEach(function(v){v.beginEnter(u);v.endEnter(u,t)});n.prototype.endEnter.call(u,t)};s.prototype.process=function(t,u){return n.prototype.process.call(this,t,u)||this.regions.reduce(function(v,w){return w.process(t,u)||v},false)};function k(u,t){n.call(this,u,t);this.isFinalState=true}k.prototype=new n();k.prototype.constructor=k;delete k.prototype.comlpetions;delete k.prototype.transitions;k.prototype.process=function(t,u){return false};function b(u,t){l.call(this,u,t);this.initial=null;if(this.owner){this.owner.regions.push(this)}}b.prototype=new l();b.prototype.constructor=b;b.prototype.isComplete=function(t){var u=i(t,this);return t.isTerminated||u===null||u.isFinalState||d(t,u)===false};b.prototype.initialise=function(t){this.beginEnter(t);this.endEnter(t,false)};b.prototype.beginExit=function(t){var u=i(t,this);if(u){u.beginExit(t);u.endExit(t)}};b.prototype.endEnter=function(u,t){var v=(t||this.initial.kind.isHistory?i(u,this):this.initial)||this.initial;v.beginEnter(u);v.endEnter(u,t||this.initial.kind===f.DeepHistory)};b.prototype.process=function(t,u){if(t.isTerminated){return false}return d(t,this)&&i(t,this).process(t,u)};function m(t){l.call(this,t);this.regions=[]}m.prototype=new l();m.prototype.constructor=m;m.prototype.isComplete=function(t){return t.isTerminated||this.regions.every(function(u){return u.isComplete(t)})};m.prototype.initialise=function(t){this.beginEnter(t);this.endEnter(t,false)};m.prototype.beginExit=function(t){this.regions.forEach(function(u){if(d(t,this)){u.beginExit(t);u.endExit(t)}})};m.prototype.endEnter=function(u,t){this.regions.forEach(function(v){v.beginEnter(u);v.endEnter(u,t)});l.prototype.endEnter.call(u,t)};m.prototype.process=function(t,u){if(t.isTerminated){return false}return this.regions.reduce(function(v,w){return w.process(t,u)||v},false)};q.PseudoStateKind=f;q.PseudoState=h;q.SimpleState=n;q.CompositeState=j;q.OrthogonalState=s;q.FinalState=k;q.Region=b;q.StateMachine=m;q.Transition=e}if(this.exports){initStateJS(this.exports)}else{if(this.define){this.define(function(b,a,c){initStateJS(a)})}else{initStateJS(this)}};