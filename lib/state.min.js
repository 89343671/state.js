!function t(n,i,e){function o(a,s){if(!i[a]){if(!n[a]){var u="function"==typeof require&&require
if(!s&&u)return u(a,!0)
if(r)return r(a,!0)
var c=new Error("Cannot find module '"+a+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=i[a]={exports:{}}
n[a][0].call(h.exports,function(t){var i=n[a][1][t]
return o(i?i:t)},h,h.exports,t,n,i,e)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<e.length;a++)o(e[a])
return o}({1:[function(t,n){var i
!function(t){!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(t.PseudoStateKind||(t.PseudoStateKind={}))
t.PseudoStateKind}(i||(i={}))
var i
!function(t){var n=function(){function t(t){this.name=t}return t.prototype.getParent=function(){},t.prototype.getRoot=function(){return this.getParent().getRoot()},t.prototype.ancestors=function(){return(this.getParent()?this.getParent().ancestors():[]).concat(this)},t.prototype.accept=function(){},t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
t.Element=n}(i||(i={}))
var i,e=this.__extends||function(t,n){function i(){this.constructor=t}for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])
i.prototype=n.prototype,t.prototype=new i}
!function(t){var n=function(t){function n(n,i){t.call(this,n),this.vertices=[],this.state=i,this.state.regions.push(this),this.state.getRoot().clean=!1}return e(n,t),n.prototype.getParent=function(){return this.state},n.prototype.accept=function(t,n,i,e){return t.visitRegion(this,n,i,e)},n.defaultName="default",n}(t.Element)
t.Region=n}(i||(i={}))
var i
!function(t){var n=function(n){function i(i,e){n.call(this,i),this.transitions=[],e instanceof t.Region?this.region=e:e instanceof t.State&&(this.region=e.defaultRegion()),this.region&&(this.region.vertices.push(this),this.region.getRoot().clean=!1)}return e(i,n),i.prototype.getParent=function(){return this.region},i.prototype.to=function(n){var i=new t.Transition(this,n)
return this.transitions.push(i),this.getRoot().clean=!1,i},i}(t.Element)
t.Vertex=n}(i||(i={}))
var i
!function(t){var n=function(n){function i(i,e,o){void 0===o&&(o=t.PseudoStateKind.Initial),n.call(this,i,e),this.kind=o,this.isInitial()&&(this.region.initial=this)}return e(i,n),i.prototype.isHistory=function(){return this.kind===t.PseudoStateKind.DeepHistory||this.kind===t.PseudoStateKind.ShallowHistory},i.prototype.isInitial=function(){return this.kind===t.PseudoStateKind.Initial||this.isHistory()},i.prototype.accept=function(t,n,i,e){return t.visitPseudoState(this,n,i,e)},i}(t.Vertex)
t.PseudoState=n}(i||(i={}))
var i
!function(t){var n=function(n){function i(t,i){n.call(this,t,i),this.exitBehavior=[],this.entryBehavior=[],this.regions=[]}return e(i,n),i.prototype.defaultRegion=function(){var n
return this.regions.forEach(function(i){i.name===t.Region.defaultName&&(n=i)}),n||(n=new t.Region(t.Region.defaultName,this)),n},i.prototype.isFinal=function(){return 0===this.transitions.length},i.prototype.isSimple=function(){return 0===this.regions.length},i.prototype.isComposite=function(){return this.regions.length>0},i.prototype.isOrthogonal=function(){return this.regions.length>1},i.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},i.prototype.entry=function(t){return this.entryBehavior.push(t),this.getRoot().clean=!1,this},i.prototype.accept=function(t,n,i,e){return t.visitState(this,n,i,e)},i}(t.Vertex)
t.State=n}(i||(i={}))
var i
!function(t){var n=function(t){function n(n,i){t.call(this,n,i)}return e(n,t),n.prototype.to=function(){throw"A FinalState cannot be the source of a transition."},n.prototype.accept=function(t,n,i,e){return t.visitFinalState(this,n,i,e)},n}(t.State)
t.FinalState=n}(i||(i={}))
var i
!function(t){var n=function(t){function n(n){t.call(this,n,void 0),this.clean=!1}return e(n,t),n.prototype.getRoot=function(){return this.region?this.region.getRoot():this},n.prototype.setLogger=function(t){return void 0===t&&(t=void 0),this.logTo=t,this.clean=!1,this},n.prototype.setWarning=function(t){return void 0===t&&(t=void 0),this.warnTo=t,this.clean=!1,this},n.prototype.accept=function(t,n,i,e){return t.visitStateMachine(this,n,i,e)},n}(t.State)
t.StateMachine=n}(i||(i={}))
var i
!function(t){!function(t){t[t.Internal=0]="Internal",t[t.Local=1]="Local",t[t.External=2]="External"}(t.TransitionKind||(t.TransitionKind={}))
t.TransitionKind}(i||(i={}))
var i
!function(t){var n=function(){function n(n,i){var e=this
if(this.source=n,this.target=i,this.transitionBehavior=[],this.traverse=[],this.guard=function(t){return t===e.source},this.kind=i?t.TransitionKind.External:t.TransitionKind.Internal,this.kind===t.TransitionKind.Local&&-1===this.target.ancestors().indexOf(this.source)){var o=this.source.getRoot().warnTo
o&&o.warn("Transition cannot be local as source is not in the ancestry of target"),this.kind=t.TransitionKind.External}}return n.prototype["else"]=function(){return this.guard=n.isElse,this},n.prototype.when=function(t){return this.guard=t,this},n.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.getRoot().clean=!1,this},n.prototype.accept=function(t,n,i,e){return t.visitTransition(this,n,i,e)},n.isElse=function(){return!1},n}()
t.Transition=n}(i||(i={}))
var i
!function(t){var n=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,n,i,e){var o=this,r=this.visitElement(t,n,i,e)
return t.vertices.forEach(function(t){t.accept(o,n,i,e)}),r},t.prototype.visitVertex=function(t,n,i,e){var o=this,r=this.visitElement(t,n,i,e)
return t.transitions.forEach(function(t){t.accept(o,n,i,e)}),r},t.prototype.visitPseudoState=function(t,n,i,e){return this.visitVertex(t,n,i,e)},t.prototype.visitState=function(t,n,i,e){var o=this,r=this.visitVertex(t,n,i,e)
return t.regions.forEach(function(t){t.accept(o,n,i,e)}),r},t.prototype.visitFinalState=function(t,n,i,e){return this.visitState(t,n,i,e)},t.prototype.visitStateMachine=function(t,n,i,e){return this.visitState(t,n,i,e)},t.prototype.visitTransition=function(){},t}()
t.Visitor=n}(i||(i={}))
var i
!function(t){var n=function(){function t(t){void 0===t&&(t="unnamed"),this.name=t,this.last={},this.isTerminated=!1}return t.prototype.setCurrent=function(t,n){this.last[t.qualifiedName]=n},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
t.StateMachineInstance=n}(i||(i={}))
var i
!function(t){function n(t,i,e){void 0===e&&(e=!0),i?(e&&t.clean===!1&&n(t),t.logTo&&t.logTo.log("initialise "+i),a(t.onInitialise,void 0,i)):(t.logTo&&t.logTo.log("initialise "+t.name),t.accept(new l,!1),t.clean=!0)}function i(t,i,e,o){return void 0===o&&(o=!0),t.logTo&&t.logTo.log(i+" evaluate "+e),o&&t.clean===!1&&n(t),i.isTerminated?!1:t.accept(h.instance,i,e)}function o(n,i){return n instanceof t.State?n.regions.every(function(t){return i.getCurrent(t).isFinal()}):!0}function r(t){u=t}function a(t,n,i,e){void 0===e&&(e=!1),t.forEach(function(t){t(n,i,e)})}function s(t,n){return t.region?s(t.region.state,n)&&n.getCurrent(t.region)===t:!0}t.initialise=n,t.evaluate=i,t.isComplete=o,t.setRandom=r
var u=function(t){return Math.floor(Math.random()*t)},c=function(){function t(){this.leave=[],this.beginEnter=[],this.endEnter=[],this.enter=[]}return t}(),h=function(n){function i(){n.apply(this,arguments)}return e(i,n),i.prototype.visitRegion=function(t,n,i){return n.getCurrent(t).accept(this,n,i)},i.prototype.visitPseudoState=function(n,i,e){var o,r=this
switch(n.kind){case t.PseudoStateKind.Initial:case t.PseudoStateKind.DeepHistory:case t.PseudoStateKind.ShallowHistory:if(1!==n.transitions.length)throw"Initial transition must have a single outbound transition from "+n
o=n.transitions[0]
break
case t.PseudoStateKind.Junction:var s,c
n.transitions.forEach(function(n){if(n.guard===t.Transition.isElse){if(c)throw"Multiple outbound transitions evaluated true"
c=n}else if(n.guard(e,i)){if(s)throw"Multiple outbound transitions evaluated true"
s=n}}),o=s||c
break
case t.PseudoStateKind.Choice:var h=[]
n.transitions.forEach(function(n){if(n.guard===t.Transition.isElse){if(c)throw"Multiple outbound else transitions found at "+r+" for "+e
c=n}else n.guard(e,i)&&h.push(n)}),o=0!==h.length?h[u(h.length)]:c}return o?(a(o.traverse,e,i),!0):!1},i.prototype.visitState=function(t,n,i){for(var e=!1,r=0,u=t.regions.length;u>r&&(!t.regions[r].accept(this,n,i)||(e=!0,s(t,n)));r++);if(!e){var c
t.transitions.forEach(function(t){if(t.guard(i,n)){if(c)throw new Error("Multiple outbound transitions evaluated true")
c=t}}),c&&(a(c.traverse,i,n),e=!0)}return e&&i!==t&&o(t,n)&&this.visitState(t,n,t),e},i.instance=new i,i}(t.Visitor),f=function(n){function i(){n.apply(this,arguments)}return e(i,n),i.prototype.visitTransition=function(n,i){n.kind===t.TransitionKind.Internal?this.visitInternalTransition(n):this.visitExternalTransition(n,i)},i.prototype.visitInternalTransition=function(t){t.traverse=t.transitionBehavior},i.prototype.visitExternalTransition=function(t,n){for(var i=t.source.ancestors(),e=t.target.ancestors(),o=0,r=Math.min(i.length,e.length);r>o&&i[o]===e[o];)o++
for(t.traverse=n(o<i.length?i[o]:t.source).leave.slice(0),t.traverse=t.traverse.concat(t.transitionBehavior),o>=e.length&&(t.traverse=t.traverse.concat(n(t.target).beginEnter));o<e.length;)this.cascadeElementEntry(t,n,e[o++],o<e.length?e[o]:void 0)
t.traverse=t.traverse.concat(n(t.target).endEnter)},i.prototype.cascadeElementEntry=function(n,i,e,o){n.traverse=n.traverse.concat(i(e).beginEnter),e instanceof t.State&&this.cascadeOrthogonalRegionEntry(n,i,e,o)},i.prototype.cascadeOrthogonalRegionEntry=function(t,n,i,e){i.isOrthogonal()&&i.regions.forEach(function(i){i!==e&&(t.traverse=t.traverse.concat(n(i).enter))})},i}(t.Visitor),l=function(n){function i(){n.apply(this,arguments),this.behaviours={}}return e(i,n),i.prototype.behaviour=function(n){return n.qualifiedName||(n.qualifiedName=n.ancestors().map(function(t){return t.name}).join(t.Element.namespaceSeparator)),this.behaviours[n.qualifiedName]||(this.behaviours[n.qualifiedName]=new c)},i.prototype.visitElement=function(t){if(t.getRoot().logTo){var n=this.behaviour(t),i=t.getRoot().logTo
n.leave.push(function(n,e){i.log(e+" leave "+t)}),n.beginEnter.push(function(n,e){i.log(e+" enter "+t)})}},i.prototype.visitRegion=function(n,i){var e=this,o=this.behaviour(n)
n.vertices.forEach(function(o){o.accept(e,i||n.initial&&n.initial.kind===t.PseudoStateKind.DeepHistory)}),o.leave.push(function(t,i){a(e.behaviour(i.getCurrent(n)).leave,t,i)}),i||!n.initial||n.initial.isHistory()?o.endEnter.push(function(i,o,r){var s=n.initial;(r||n.initial.isHistory())&&(s=o.getCurrent(n)||n.initial),a(e.behaviour(s).enter,i,o,r||n.initial.kind===t.PseudoStateKind.DeepHistory)}):o.endEnter=o.endEnter.concat(this.behaviour(n.initial).enter),this.visitElement(n,i),o.enter=o.beginEnter.concat(o.endEnter)},i.prototype.visitVertex=function(t,n){this.visitElement(t,n),this.behaviour(t).endEnter.push(function(n,i){o(t,i)&&t.accept(h.instance,i,t)})},i.prototype.visitPseudoState=function(n,i){var e=this.behaviour(n)
this.visitVertex(n,i),n.kind===t.PseudoStateKind.Terminate&&e.beginEnter.push(function(t,n){n.isTerminated=!0}),e.enter=e.beginEnter.concat(e.endEnter)},i.prototype.visitState=function(t,n){var i=this,e=this.behaviour(t)
t.regions.forEach(function(t){var o=i.behaviour(t)
t.accept(i,n),e.leave=e.leave.concat(o.leave),e.endEnter=e.endEnter.concat(o.enter)}),this.visitVertex(t,n),e.leave=e.leave.concat(t.exitBehavior),e.beginEnter=e.beginEnter.concat(t.entryBehavior),e.beginEnter.push(function(n,i){t.region&&i.setCurrent(t.region,t)}),e.enter=e.beginEnter.concat(e.endEnter)},i.prototype.visitStateMachine=function(t,n){var i=this
this.visitState(t,n),t.accept(new f,function(t){return i.behaviour(t)}),t.onInitialise=this.behaviour(t).enter},i}(t.Visitor)}(i||(i={}))
var n=n
n.exports=i},{}],2:[function(t){!function(n){var i=document.currentScript
if(!i){var e=document.getElementsByTagName("script")
i=e[e.length-1]}n[i.attributes.target?i.attributes.target.textContent:"fsm"]=t("../lib/state.com.js")}(window)},{"../lib/state.com.js":1}]},{},[2])
