!function t(i,n,e){function o(s,a){if(!n[s]){if(!i[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}};i[s][0].call(h.exports,function(t){var n=i[s][1][t];return o(n?n:t)},h,h.exports,t,i,n,e)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<e.length;s++)o(e[s]);return o}({1:[function(t,i,n){"use strict";function e(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var e=0,o=i;e<o.length;e++)for(var r=o[e],s=0,a=r;s<a.length;s++){var u=a[s];t.push(u)}}function o(t){n.random=t}function r(t,i,n,e){for(var o=0,r=t;o<r.length;o++){var s=r[o];s(i,n,e)}}var s=this&&this.__extends||function(t,i){function n(){this.constructor=t}for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)};n.random=function(t){return Math.floor(Math.random()*t)},n.setRandom=o,function(t){t[t.Choice=0]="Choice",t[t.DeepHistory=1]="DeepHistory",t[t.Initial=2]="Initial",t[t.Junction=3]="Junction",t[t.ShallowHistory=4]="ShallowHistory"}(n.PseudoStateKind||(n.PseudoStateKind={}));var a=n.PseudoStateKind;!function(t){t[t.External=0]="External",t[t.Internal=1]="Internal",t[t.Local=2]="Local"}(n.TransitionKind||(n.TransitionKind={}));var u=n.TransitionKind,c=function(){function t(i,n){this.name=i,this.parent=n,this.qualifiedName=n?n.toString()+t.namespaceSeparator+i:i,console.log("created "+this)}return t.prototype.getAncestors=function(){return this.parent.getAncestors().concat(this)},t.prototype.getRoot=function(){return this.parent.getRoot()},t.prototype.isActive=function(t){return this.parent.isActive(t)},t.prototype.accept=function(t,i){t.visitElement(this,i)},t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}();n.NamedElement=c;var h=function(t){function i(i,n){t.call(this,i,n),this.vertices=new Array,this.parent.regions.push(this),this.getRoot().clean=!1}return s(i,t),i.prototype.isComplete=function(t){var i=t.getCurrent(this);return void 0!==i&&i.isFinal()},i.prototype.accept=function(t,i){t.visitRegion(this,i)},i.defaultName="default",i}(c);n.Region=h;var p=function(t){function i(i,n){t.call(this,i,n instanceof h?n:n.getDefaultRegion()),this.outgoing=new Array,this.incoming=new Array,this.parent.vertices.push(this),this.getRoot().clean=!1}return s(i,t),i.prototype.to=function(t,i){return void 0===i&&(i=u.External),new v(this,t,i)},i.prototype.accept=function(t,i){t.visitVertex(this,i)},i}(c);n.Vertex=p;var f=function(t){function i(i,n,e){void 0===e&&(e=a.Initial),t.call(this,i,n),this.kind=e}return s(i,t),i.prototype.isHistory=function(){return this.kind===a.DeepHistory||this.kind===a.ShallowHistory},i.prototype.isInitial=function(){return this.kind===a.Initial||this.isHistory()},i.prototype.accept=function(t,i){t.visitPseudoState(this,i)},i}(p);n.PseudoState=f;var l=function(t){function i(i,n){t.call(this,i,n),this.regions=new Array,this.entryBehavior=new Array,this.exitBehavior=new Array}return s(i,t),i.prototype.getDefaultRegion=function(){return this.defaultRegion||(this.defaultRegion=new h(h.defaultName,this))},i.prototype.isFinal=function(){return 0===this.outgoing.length},i.prototype.isSimple=function(){return 0===this.regions.length},i.prototype.isComposite=function(){return this.regions.length>0},i.prototype.isOrthogonal=function(){return this.regions.length>1},i.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},i.prototype.enter=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},i.prototype.isActive=function(i){return t.prototype.isActive.call(this,i)&&i.getCurrent(this.parent)===this},i.prototype.isComplete=function(t){return this.regions.every(function(i){return i.isComplete(t)})},i.prototype.accept=function(t,i){t.visitState(this,i)},i}(p);n.State=l;var g=function(){function t(t){this.name=t,this.regions=new Array,this.defaultRegion=void 0,this.clean=!1,this.onInitialise=new Array}return t.prototype.getDefaultRegion=function(){return this.defaultRegion||(this.defaultRegion=new h(h.defaultName,this))},t.prototype.getAncestors=function(){return[this]},t.prototype.getRoot=function(){return this},t.prototype.accept=function(t,i){t.visitStateMachine(this,i)},t.prototype.isActive=function(t){return!0},t.prototype.isComplete=function(t){return this.regions.every(function(i){return i.isComplete(t)})},t.prototype.initialise=function(t,i){void 0===i&&(i=!0),t?(i&&this.clean===!1&&this.initialise(),console.log("initialise "+t),r(this.onInitialise,void 0,t,!1)):(console.log("initialise "+this),this.accept(new S),this.clean=!0)},t.prototype.toString=function(){return this.name},t}();n.StateMachine=g;var v=function(){function t(t,i,n){var e=this;void 0===n&&(n=u.External),this.source=t,this.target=i,this.kind=n,this.effectBehavior=new Array,this.guard=t instanceof f?function(){return!0}:function(t){return t===e.source},this.source.outgoing.push(this),this.source.getRoot().clean=!1,this.target?this.target.incoming.push(this):this.kind=u.Internal,console.log("created transition from "+t+" to "+i)}return t.prototype.else=function(){return this.guard=function(){return!1},this},t.prototype.when=function(t){return this.guard=t,this},t.prototype.effect=function(t){return this.effectBehavior.push(t),this.source.getRoot().clean=!1,this},t.prototype.accept=function(t,i){t.visitTransition(this,i)},t.prototype.toString=function(){return u[this.kind]+"("+(this.kind===u.Internal?this.source:this.source+" -> "+this.target)+")"},t}();n.Transition=v;var y=function(){function t(){}return t.prototype.visitElement=function(t,i){console.log("visiting "+t.toString())},t.prototype.visitRegion=function(t,i){for(var n=0,e=t.vertices;n<e.length;n++){var o=e[n];o.accept(this,i)}this.visitElement(t,i)},t.prototype.visitVertex=function(t,i){for(var n=0,e=t.outgoing;n<e.length;n++){var o=e[n];o.accept(this,i)}this.visitElement(t,i)},t.prototype.visitPseudoState=function(t,i){this.visitVertex(t,i)},t.prototype.visitState=function(t,i){for(var n=0,e=t.regions;n<e.length;n++){var o=e[n];o.accept(this,i)}this.visitVertex(t,i)},t.prototype.visitStateMachine=function(t,i){for(var n=0,e=t.regions;n<e.length;n++){var o=e[n];o.accept(this,i)}this.visitElement(t,i)},t.prototype.visitTransition=function(t,i){console.log("visiting "+t)},t}();n.Visitor=y;var d=function(){function t(t){this.name=t,this.activeStateConfiguration={}}return t.prototype.setCurrent=function(t,i){this.activeStateConfiguration[t.qualifiedName]=i},t.prototype.getCurrent=function(t){return this.activeStateConfiguration[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}();n.DictionaryInstance=d;var m=function(){function t(){this.leave=new Array,this.beginEnter=new Array,this.endEnter=new Array}return t}(),S=function(t){function i(){t.apply(this,arguments),this.elementActions={},this.transitions=new Array}return s(i,t),i.prototype.getActions=function(t){return this.elementActions[t.toString()]||(this.elementActions[t.toString()]=new m)},i.prototype.visitElement=function(t,i){this.getActions(t).leave.push(function(i,n){return console.log(n+" leave "+t)}),this.getActions(t).beginEnter.push(function(i,n){return console.log(n+" enter "+t)})},i.prototype.visitTransition=function(i,n){t.prototype.visitTransition.call(this,i,n),this.transitions.push(i)},i.prototype.visitStateMachine=function(i,n){t.prototype.visitStateMachine.call(this,i,n);for(var o=0,r=this.transitions;o<r.length;o++){var s=r[o];console.log("init trans: "+s)}for(var a=0,u=i.regions;a<u.length;a++){var c=u[a];e(i.onInitialise,this.getActions(c).beginEnter,this.getActions(c).endEnter)}},i}(y)},{}],2:[function(t,i,n){window[((document.currentScript||document.getElementsByTagName("script")[scripts.length-1]).attributes.target||{textContent:"fsm"}).textContent]=t("../lib/node/state.js")},{"../lib/node/state.js":1}]},{},[2]);
