<!DOCTYPE html>
<html lang="en">
    <head>
        <title>state.js v5.3.0 example</title>
    </head>
	<body>
        <h1>state.js v5.3.0 example</h1>
		<p>This example implements a simple controller for a cassette player according to the model below:</p>
		<p><img id="diagram" /></p>
		<p>Press the buttons below to send events to the controller (check brower console for trace output):</p>
		<button type="button">play</button>
		<button type="button">pause</button>
		<button type="button">stop</button>
		<button type="button" >flip</button>
		<button type="button" >off</button>
		<p id="head">Head: disengaged</p>
		<p id="motor">Motor: stopped</p>

	    <!-- import jQuery -->
	    <script src="jquery-1.11.2.min.js"></script>
	
	    <!-- import the state machine runtime -->
	    <script src="../../lib/state.js"></script>
	
	    <!-- script to wire the core player to the web page -->
	    <script>
			/* global $, fsm */      
	       $(document).ready(function() {
			   /* create the state machine model elements */
				var model = new fsm.StateMachine ("model");
				var initial = new fsm.PseudoState ("initial", model, fsm.PseudoStateKind.Initial);
				var operational = new fsm.State ("operational", model);
				var flipped = new fsm.State ("flipped", model);
				var finalState = new fsm.FinalState ("final", model);
				var deepHistory = new fsm.PseudoState ("history", operational, fsm.PseudoStateKind.DeepHistory);
				var stopped = new fsm.State ("stopped", operational);
				var active = new fsm.State ("active", operational);
				var running = new fsm.State ("running", active);
				var paused = new fsm.State ("paused", active);
				
				/* create the state machine model transitions */
				initial.to (operational);
				deepHistory.to (stopped);		
				stopped.to (running).when (function (s) { return s === "play"; });
				active.to (stopped).when (function (s) { return s === "stop"; });
				running.to (paused).when (function (s) { return s === "pause"; });
				paused.to (running).when (function (s) { return s === "play"; });
				operational.to (flipped).when (function (s) { return s === "flip"; });
				flipped.to (operational).when (function (s) { return s === "flip"; });
				operational.to (finalState).when (function (s) { return s === "off"; });
	
	            /* add core behaviour to appropriate states and transitions in the player machine*/
	            active.entry (function () { $("#head").text ("Head: engaged"); }).exit (function () { $("#head").text ("Head: disengaged"); });
	            running.entry (function () { $("#motor").text ("Motor: running"); }).exit (function() { $("#motor").text ("Motor: stopped"); });
	
	            /* add a little more behavior to states to adjust the graphic*/
	            stopped.entry (function () { $("#diagram").attr ("src", "controller_stopped.png"); });
	            running.entry (function () { $("#diagram").attr ("src", "controller_running.png"); });
	            paused.entry (function () { $( "#diagram" ).attr ("src", "controller_paused.png"); });
	            finalState.entry (function () { $("#diagram").attr ("src", "controller_final.png"); });
	            flipped.entry (function () { $("#diagram").attr ("src", "controller_flipped.png"); });
	
	            /* create the state machine instance object */
	            var instance = new fsm.StateMachineInstance ("player");
	
	            /* initialise the state machine model and instance */
	            fsm.initialise (model, instance);
	
	            /* pass button values to the state machine when clicked */
	            $("button").click (function (button) { fsm.evaluate (model, instance, button.target.textContent); });
	        });
    	</script>
	</body>
</html>