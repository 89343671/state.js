!function t(i,e,n){function r(s,a){if(!e[s]){if(!i[s]){var u="function"==typeof require&&require
if(!a&&u)return u(s,!0)
if(o)return o(s,!0)
var c=new Error("Cannot find module '"+s+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=e[s]={exports:{}}
i[s][0].call(h.exports,function(t){var e=i[s][1][t]
return r(e?e:t)},h,h.exports,t,i,e,n)}return e[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s])
return r}({1:[function(t,i,e){function n(t,i,e){void 0===e&&(e=!0),i?(e&&t.clean===!1&&n(t),s(t.onInitialise,void 0,i)):(t.accept(new x,!1),t.clean=!0)}function r(t,i,e,r){return void 0===r&&(r=!0),r&&t.clean===!1&&n(t),i.isTerminated?!1:t.accept(b.instance,i,e)}function o(t,i){return t instanceof l?t.regions.every(function(t){return i.getCurrent(t).isFinal()}):!0}function s(t,i,e,n){void 0===n&&(n=!1),t.forEach(function(t){t(i,e,n)})}function a(t,i){return t.region?a(t.region.state,i)&&i.getCurrent(t.region)===t:!0}var u=this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])
e.prototype=i.prototype,t.prototype=new e}
!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(e.PseudoStateKind||(e.PseudoStateKind={}))
var c=e.PseudoStateKind,h=function(){function t(t){this.name=t}return t.prototype.getParent=function(){},t.prototype.root=function(){return this.getParent().root()},t.prototype.ancestors=function(){return(this.getParent()?this.getParent().ancestors():[]).concat(this)},t.prototype.accept=function(){},t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
e.Element=h
var f=function(t){function i(i,e){t.call(this,i),this.vertices=[],this.state=e,this.state.regions.push(this),this.state.root().clean=!1}return u(i,t),i.prototype.getParent=function(){return this.state},i.prototype.accept=function(t,i,e,n,r){return t.visitRegion(this,i,e,n,r)},i.defaultName="default",i}(h)
e.Region=f
var p=function(t){function i(i,e){t.call(this,i),this.transitions=[],e instanceof f?this.region=e:e instanceof l&&(this.region=e.defaultRegion()),this.region&&(this.region.vertices.push(this),this.region.root().clean=!1)}return u(i,t),i.prototype.getParent=function(){return this.region},i.prototype.to=function(t){var i=new y(this,t)
return this.transitions.push(i),this.root().clean=!1,i},i}(h)
e.Vertex=p
var v=function(t){function i(i,e,n){t.call(this,i,e),this.kind=n,this.isInitial()&&(this.region.initial=this)}return u(i,t),i.prototype.isHistory=function(){return this.kind===c.DeepHistory||this.kind===c.ShallowHistory},i.prototype.isInitial=function(){return this.kind===c.Initial||this.isHistory()},i.prototype.accept=function(t,i,e,n,r){return t.visitPseudoState(this,i,e,n,r)},i}(p)
e.PseudoState=v
var l=function(t){function i(i,e){t.call(this,i,e),this.exitBehavior=[],this.entryBehavior=[],this.regions=[]}return u(i,t),i.prototype.defaultRegion=function(){var t
return this.regions.forEach(function(i){i.name===f.defaultName&&(t=i)}),t||(t=new f(f.defaultName,this)),t},i.prototype.isFinal=function(){return 0===this.transitions.length},i.prototype.isSimple=function(){return 0===this.regions.length},i.prototype.isComposite=function(){return this.regions.length>0},i.prototype.isOrthogonal=function(){return this.regions.length>1},i.prototype.exit=function(t){return this.exitBehavior.push(t),this.root().clean=!1,this},i.prototype.entry=function(t){return this.entryBehavior.push(t),this.root().clean=!1,this},i.prototype.accept=function(t,i,e,n,r){return t.visitState(this,i,e,n,r)},i}(p)
e.State=l
var g=function(t){function i(i,e){t.call(this,i,e)}return u(i,t),i.prototype.to=function(){throw"A FinalState cannot be the source of a transition."},i.prototype.accept=function(t,i,e,n,r){return t.visitFinalState(this,i,e,n,r)},i}(l)
e.FinalState=g
var d=function(t){function i(i){t.call(this,i,void 0),this.clean=!1}return u(i,t),i.prototype.root=function(){return this.region?this.region.root():this},i.prototype.accept=function(t,i,e,n,r){return t.visitStateMachine(this,i,e,n,r)},i}(l)
e.StateMachine=d
var y=function(){function t(t,i){var e=this
this.source=t,this.target=i,this.transitionBehavior=[],this.traverse=[],this.guard=function(t){return t===e.source}}return t.prototype["else"]=function(){return this.guard=t.isElse,this},t.prototype.when=function(t){return this.guard=t,this},t.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.root().clean=!1,this},t.prototype.accept=function(t,i,e,n,r){return t.visitTransition(this,i,e,n,r)},t.isElse=function(){return!1},t}()
e.Transition=y
var m=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,i,e,n,r){var o=this,s=this.visitElement(t,i,e,n,r)
return t.vertices.forEach(function(t){t.accept(o,i,e,n,r)}),s},t.prototype.visitVertex=function(t,i,e,n,r){var o=this,s=this.visitElement(t,i,e,n,r)
return t.transitions.forEach(function(t){t.accept(o,i,e,n,r)}),s},t.prototype.visitPseudoState=function(t,i,e,n,r){return this.visitVertex(t,i,e,n,r)},t.prototype.visitState=function(t,i,e,n,r){var o=this,s=this.visitVertex(t,i,e,n,r)
return t.regions.forEach(function(t){t.accept(o,i,e,n,r)}),s},t.prototype.visitFinalState=function(t,i,e,n,r){return this.visitState(t,i,e,n,r)},t.prototype.visitStateMachine=function(t,i,e,n,r){return this.visitState(t,i,e,n,r)},t.prototype.visitTransition=function(){},t}()
e.Visitor=m
var E=function(){function t(t){void 0===t&&(t="unnamed"),this.name=t,this.last={},this.isTerminated=!1}return t.prototype.setCurrent=function(t,i){this.last[t.qualifiedName]=i},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
e.StateMachineInstance=E,e.initialise=n,e.evaluate=r,e.isComplete=o
var S=function(){function t(){this.leave=[],this.beginEnter=[],this.endEnter=[],this.enter=[]}return t}(),b=function(t){function i(){t.apply(this,arguments)}return u(i,t),i.prototype.visitRegion=function(t,i,e){return i.getCurrent(t).accept(this,i,e)},i.prototype.visitPseudoState=function(t,i,e){var n,r=this
switch(t.kind){case c.Initial:case c.DeepHistory:case c.ShallowHistory:if(1!==t.transitions.length)throw"Initial transition must have a single outbound transition from "+t
n=t.transitions[0]
break
case c.Junction:var o,a
t.transitions.forEach(function(t){if(t.guard===y.isElse){if(a)throw"Multiple outbound transitions evaluated true"
a=t}else if(t.guard(e,i)){if(o)throw"Multiple outbound transitions evaluated true"
o=t}}),n=o||a
break
case c.Choice:var u=[]
t.transitions.forEach(function(t){if(t.guard===y.isElse){if(a)throw"Multiple outbound else transitions found at "+r+" for "+e
a=t}else t.guard(e,i)&&u.push(t)}),n=0!==u.length?u[Math.round((u.length-1)*Math.random())]:a}return n?(s(n.traverse,e,i),!0):!1},i.prototype.visitState=function(t,i,e){for(var n=!1,r=0,u=t.regions.length;u>r&&(!t.regions[r].accept(this,i,e)||(n=!0,a(t,i)));r++);if(!n){var c
t.transitions.forEach(function(t){if(t.guard(e,i)){if(c)throw new Error("Multiple outbound transitions evaluated true")
c=t}}),c&&(s(c.traverse,e,i),n=!0)}return n&&e!==t&&o(t,i)&&this.visitState(t,i,t),n},i.instance=new i,i}(m),w=function(t){function i(){t.apply(this,arguments)}return u(i,t),i.prototype.visitTransition=function(t,i){if(t.target)if(t.target.region===t.source.region)t.traverse=i(t.source).leave.concat(t.transitionBehavior).concat(i(t.target).enter)
else{for(var e=t.source.ancestors(),n=t.target.ancestors(),r=e.length,o=n.length,s=0,a=Math.min(r,o);a>s&&e[s]===n[s];)s++
if(e[s]instanceof f)throw"Transitions may not cross sibling orthogonal region boundaries"
for(t.traverse=i(r>s?e[s]:t.source).leave.slice(0),t.traverse=t.traverse.concat(t.transitionBehavior),s>=o&&(t.traverse=t.traverse.concat(i(t.target).beginEnter));o>s;){var u=n[s++],c=o>s?n[s]:void 0
if(t.traverse=t.traverse.concat(i(u).beginEnter),u instanceof l){var h=u
h.isOrthogonal()&&h.regions.forEach(function(e){e!==c&&(t.traverse=t.traverse.concat(i(e).enter))})}}t.traverse=t.traverse.concat(i(t.target).endEnter)}else t.traverse=t.transitionBehavior},i}(m),x=function(t){function i(){t.apply(this,arguments),this.behaviours={}}return u(i,t),i.prototype.behaviour=function(t){return t.qualifiedName||(t.qualifiedName=t.ancestors().map(function(t){return t.name}).join(h.namespaceSeparator)),this.behaviours[t.qualifiedName]||(this.behaviours[t.qualifiedName]=new S)},i.prototype.visitRegion=function(t,i){var e=this,n=this.behaviour(t)
t.vertices.forEach(function(n){n.accept(e,i||t.initial&&t.initial.kind===c.DeepHistory)}),n.leave.push(function(i,n){s(e.behaviour(n.getCurrent(t)).leave,i,n)}),i||!t.initial||t.initial.isHistory()?n.endEnter.push(function(i,n,r){var o=t.initial;(r||t.initial.isHistory())&&(o=n.getCurrent(t)||t.initial),s(e.behaviour(o).enter,i,n,r||t.initial.kind===c.DeepHistory)}):n.endEnter=n.endEnter.concat(this.behaviour(t.initial).enter),this.visitElement(t,i),n.enter=n.beginEnter.concat(n.endEnter)},i.prototype.visitVertex=function(t,i){this.visitElement(t,i),this.behaviour(t).endEnter.push(function(i,e){o(t,e)&&t.accept(b.instance,e,t)})},i.prototype.visitPseudoState=function(t,i){var e=this.behaviour(t)
this.visitVertex(t,i),t.kind===c.Terminate&&e.enter.push(function(t,i){i.isTerminated=!0}),e.enter=e.beginEnter.concat(e.endEnter)},i.prototype.visitState=function(t,i){var e=this,n=this.behaviour(t)
t.regions.forEach(function(t){var r=e.behaviour(t)
t.accept(e,i),n.leave=n.leave.concat(r.leave),n.endEnter=n.endEnter.concat(r.enter)}),this.visitVertex(t,i),n.leave=n.leave.concat(t.exitBehavior),n.beginEnter=n.beginEnter.concat(t.entryBehavior),n.beginEnter.push(function(i,e){t.region&&e.setCurrent(t.region,t)}),n.enter=n.beginEnter.concat(n.endEnter)},i.prototype.visitStateMachine=function(t,i){var e=this
this.visitState(t,i),t.accept(new w,function(t){return e.behaviour(t)}),t.onInitialise=this.behaviour(t).enter},i}(m)},{}],2:[function(t){fsm=t("./state.com.js")},{"./state.com.js":1}]},{},[2])
