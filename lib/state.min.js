!function t(n,i,e){function o(a,s){if(!i[a]){if(!n[a]){var u="function"==typeof require&&require
if(!s&&u)return u(a,!0)
if(r)return r(a,!0)
var c=new Error("Cannot find module '"+a+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=i[a]={exports:{}}
n[a][0].call(h.exports,function(t){var i=n[a][1][t]
return o(i?i:t)},h,h.exports,t,n,i,e)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<e.length;a++)o(e[a])
return o}({1:[function(t,n){var i
!function(t){var n=function(){function t(t){this.actions=[],t&&this.push(t)}return t.prototype.push=function(n){return Array.prototype.push.apply(this.actions,n instanceof t?n.actions:arguments),this},t.prototype.hasActions=function(){return 0!==this.actions.length},t.prototype.invoke=function(t,n,i){void 0===i&&(i=!1),this.actions.forEach(function(e){return e(t,n,i)})},t}()
t.Behavior=n}(i||(i={}))
var i
!function(t){!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(t.PseudoStateKind||(t.PseudoStateKind={}))
t.PseudoStateKind}(i||(i={}))
var i
!function(t){!function(t){t[t.Internal=0]="Internal",t[t.Local=1]="Local",t[t.External=2]="External"}(t.TransitionKind||(t.TransitionKind={}))
t.TransitionKind}(i||(i={}))
var i
!function(t){var n=function(){function t(n,i){this.name=n,this.qualifiedName=i?i.qualifiedName+t.namespaceSeparator+n:n}return t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
t.Element=n}(i||(i={}))
var i,e=this&&this.__extends||function(t,n){function i(){this.constructor=t}for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])
i.prototype=n.prototype,t.prototype=new i}
!function(t){var n=function(t){function n(n,i){t.call(this,n,i),this.vertices=[],this.state=i,this.state.regions.push(this),this.state.getRoot().clean=!1}return e(n,t),n.prototype.getRoot=function(){return this.state.getRoot()},n.prototype.accept=function(t,n,i,e){return t.visitRegion(this,n,i,e)},n.defaultName="default",n}(t.Element)
t.Region=n}(i||(i={}))
var i
!function(t){var n=function(n){function i(i,e){n.call(this,i,e=e instanceof t.State?e.defaultRegion():e),this.outgoing=[],this.region=e,this.region&&(this.region.vertices.push(this),this.region.getRoot().clean=!1)}return e(i,n),i.prototype.getRoot=function(){return this.region.getRoot()},i.prototype.to=function(n,i){return void 0===i&&(i=t.TransitionKind.External),new t.Transition(this,n,i)},i.prototype.accept=function(){},i}(t.Element)
t.Vertex=n}(i||(i={}))
var i
!function(t){var n=function(n){function i(i,e,o){void 0===o&&(o=t.PseudoStateKind.Initial),n.call(this,i,e),this.kind=o}return e(i,n),i.prototype.isHistory=function(){return this.kind===t.PseudoStateKind.DeepHistory||this.kind===t.PseudoStateKind.ShallowHistory},i.prototype.isInitial=function(){return this.kind===t.PseudoStateKind.Initial||this.isHistory()},i.prototype.accept=function(t,n,i,e){return t.visitPseudoState(this,n,i,e)},i}(t.Vertex)
t.PseudoState=n}(i||(i={}))
var i
!function(t){var n=function(n){function i(i,e){n.call(this,i,e),this.exitBehavior=new t.Behavior,this.entryBehavior=new t.Behavior,this.regions=[]}return e(i,n),i.prototype.defaultRegion=function(){return this.regions.reduce(function(n,i){return i.name===t.Region.defaultName?i:n},void 0)||new t.Region(t.Region.defaultName,this)},i.prototype.isFinal=function(){return 0===this.outgoing.length},i.prototype.isSimple=function(){return 0===this.regions.length},i.prototype.isComposite=function(){return this.regions.length>0},i.prototype.isOrthogonal=function(){return this.regions.length>1},i.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},i.prototype.entry=function(t){return this.entryBehavior.push(t),this.getRoot().clean=!1,this},i.prototype.accept=function(t,n,i,e){return t.visitState(this,n,i,e)},i}(t.Vertex)
t.State=n}(i||(i={}))
var i
!function(t){var n=function(t){function n(n,i){t.call(this,n,i)}return e(n,t),n.prototype.accept=function(t,n,i,e){return t.visitFinalState(this,n,i,e)},n}(t.State)
t.FinalState=n}(i||(i={}))
var i
!function(t){var n=function(t){function n(n){t.call(this,n,void 0),this.clean=!1}return e(n,t),n.prototype.getRoot=function(){return this.region?this.region.getRoot():this},n.prototype.accept=function(t,n,i,e){return t.visitStateMachine(this,n,i,e)},n}(t.State)
t.StateMachine=n}(i||(i={}))
var i
!function(t){var n=function(){function n(i,e,o){var r=this
void 0===o&&(o=t.TransitionKind.External),this.transitionBehavior=new t.Behavior,this.onTraverse=new t.Behavior,this.source=i,this.target=e,this.kind=e?o:t.TransitionKind.Internal,this.guard=i instanceof t.PseudoState?n.TrueGuard:function(t){return t===r.source},this.source.outgoing.push(this),this.source.getRoot().clean=!1}return n.prototype["else"]=function(){return this.guard=n.FalseGuard,this},n.prototype.when=function(t){return this.guard=t,this},n.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.getRoot().clean=!1,this},n.prototype.accept=function(t,n,i,e){return t.visitTransition(this,n,i,e)},n.prototype.toString=function(){return"["+(this.target?this.source+" -> "+this.target:this.source)+"]"},n.TrueGuard=function(){return!0},n.FalseGuard=function(){return!1},n}()
t.Transition=n}(i||(i={}))
var i
!function(t){var n=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,n,i,e){var o=this,r=this.visitElement(t,n,i,e)
return t.vertices.forEach(function(t){t.accept(o,n,i,e)}),r},t.prototype.visitVertex=function(t,n,i,e){var o=this,r=this.visitElement(t,n,i,e)
return t.outgoing.forEach(function(t){t.accept(o,n,i,e)}),r},t.prototype.visitPseudoState=function(t,n,i,e){return this.visitVertex(t,n,i,e)},t.prototype.visitState=function(t,n,i,e){var o=this,r=this.visitVertex(t,n,i,e)
return t.regions.forEach(function(t){t.accept(o,n,i,e)}),r},t.prototype.visitFinalState=function(t,n,i,e){return this.visitState(t,n,i,e)},t.prototype.visitStateMachine=function(t,n,i,e){return this.visitState(t,n,i,e)},t.prototype.visitTransition=function(){},t}()
t.Visitor=n}(i||(i={}))
var i
!function(t){var n=function(){function t(t){void 0===t&&(t="unnamed"),this.last={},this.isTerminated=!1,this.name=t}return t.prototype.setCurrent=function(t,n){this.last[t.qualifiedName]=n},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
t.StateMachineInstance=n}(i||(i={}))
var i
!function(t){function n(t){e=t}function i(){return e}t.setRandom=n,t.getRandom=i
var e=function(t){return Math.floor(Math.random()*t)}}(i||(i={}))
var i
!function(t){function n(i,e){return i instanceof t.Region?n(i.state,e):i instanceof t.State?i.region?n(i.region,e)&&e.getCurrent(i.region)===i:!0:void 0}t.isActive=n}(i||(i={}))
var i
!function(t){function n(i,e){return i instanceof t.Region?e.getCurrent(i).isFinal():i instanceof t.State?i.regions.every(function(t){return n(t,e)}):!0}t.isComplete=n}(i||(i={}))
var i
!function(t){function n(i,e,o){void 0===o&&(o=!0),e?(o&&i.clean===!1&&n(i),t.console.log("initialise "+e),i.onInitialise.invoke(void 0,e)):(t.console.log("initialise "+i.name),i.accept(new v,!1),i.clean=!0)}function i(i,e,r,a){return void 0===a&&(a=!0),t.console.log(e+" evaluate "+r),a&&i.clean===!1&&n(i),e.isTerminated?!1:o(i,e,r)}function o(n,i,e){var a=!1
if(n.regions.every(function(r){return o(i.getCurrent(r),i,e)?(a=!0,t.isActive(n,i)):!0}),a)e!==n&&t.isComplete(n,i)&&o(n,i,n)
else{var s=n.outgoing.filter(function(t){return t.guard(e,i)})
1===s.length?a=r(s[0],i,e):s.length>1&&t.console.error(n+": multiple outbound transitions evaluated true for message "+e)}return a}function r(n,i,e){for(var s=new t.Behavior(n.onTraverse),u=n.target;u&&u instanceof t.PseudoState&&u.kind===t.PseudoStateKind.Junction;)u=(n=a(u,i,e)).target,s.push(n.onTraverse)
return s.invoke(e,i),u&&u instanceof t.PseudoState&&u.kind===t.PseudoStateKind.Choice?r(a(u,i,e),i,e):u&&u instanceof t.State&&t.isComplete(u,i)&&o(u,i,u),!0}function a(n,i,e){var o=n.outgoing.filter(function(t){return t.guard(e,i)})
return n.kind===t.PseudoStateKind.Choice?0!==o.length?o[t.getRandom()(o.length)]:s(n):o.length>1?void t.console.error("Multiple outbound transition guards returned true at "+this+" for "+e):o[0]||s(n)}function s(n){return n.outgoing.filter(function(n){return n.guard===t.Transition.FalseGuard})[0]}function u(n){return n[0]||(n[0]=new t.Behavior)}function c(n){return n[1]||(n[1]=new t.Behavior)}function h(n){return n[2]||(n[2]=new t.Behavior)}function f(n){return new t.Behavior(c(n)).push(h(n))}function p(t){return(t.region?p(t.region.state):[]).concat(t)}t.initialise=n,t.evaluate=i
var l=function(n){function i(){n.apply(this,arguments)}return e(i,n),i.prototype.visitTransition=function(n,i){n.kind===t.TransitionKind.Internal?n.onTraverse.push(n.transitionBehavior):n.kind===t.TransitionKind.Local?this.visitLocalTransition(n,i):this.visitExternalTransition(n,i)},i.prototype.visitLocalTransition=function(n,i){var e=this
n.onTraverse.push(function(o,r){for(var a=p(n.target),s=0;t.isActive(a[s],r);)++s
for(u(i(r.getCurrent(a[s].region))).invoke(o,r),n.transitionBehavior.invoke(o,r);s<a.length;)e.cascadeElementEntry(n,i,a[s++],a[s],function(t){t.invoke(o,r)})
h(i(n.target)).invoke(o,r)})},i.prototype.visitExternalTransition=function(t,n){for(var i=p(t.source),e=p(t.target),o=Math.min(i.length,e.length)-1;i[o-1]!==e[o-1];)--o
for(t.onTraverse.push(u(n(i[o]))),t.onTraverse.push(t.transitionBehavior);o<e.length;)this.cascadeElementEntry(t,n,e[o++],e[o],function(n){return t.onTraverse.push(n)})
t.onTraverse.push(h(n(t.target)))},i.prototype.cascadeElementEntry=function(n,i,e,o,r){r(c(i(e))),o&&e instanceof t.State&&e.regions.forEach(function(t){r(c(i(t))),t!==o.region&&r(h(i(t)))})},i}(t.Visitor),v=function(n){function i(){n.apply(this,arguments),this.behaviours={}}return e(i,n),i.prototype.behaviour=function(t){return this.behaviours[t.qualifiedName]||(this.behaviours[t.qualifiedName]=[])},i.prototype.visitElement=function(n){t.console!==g&&(u(this.behaviour(n)).push(function(i,e){return t.console.log(e+" leave "+n)}),c(this.behaviour(n)).push(function(i,e){return t.console.log(e+" enter "+n)}))},i.prototype.visitRegion=function(n,i){var e=this,o=n.vertices.reduce(function(n,i){return i instanceof t.PseudoState&&i.isInitial()?i:n},void 0)
n.vertices.forEach(function(n){n.accept(e,i||o&&o.kind===t.PseudoStateKind.DeepHistory)}),u(this.behaviour(n)).push(function(t,i){return u(e.behaviour(i.getCurrent(n))).invoke(t,i)}),h(this.behaviour(n)).push(i||!o||o.isHistory()?function(i,r,a){f(e.behaviour(a||o.isHistory()?r.getCurrent(n)||o:o)).invoke(i,r,a||o.kind===t.PseudoStateKind.DeepHistory)}:f(this.behaviour(o))),this.visitElement(n,i)},i.prototype.visitPseudoState=function(i,e){n.prototype.visitPseudoState.call(this,i,e),i.isInitial()?h(this.behaviour(i)).push(function(t,n){return r(i.outgoing[0],n)}):i.kind===t.PseudoStateKind.Terminate&&c(this.behaviour(i)).push(function(t,n){return n.isTerminated=!0})},i.prototype.visitState=function(t,n){var i=this
t.regions.forEach(function(e){e.accept(i,n),u(i.behaviour(t)).push(u(i.behaviour(e))),h(i.behaviour(t)).push(f(i.behaviour(e)))}),this.visitVertex(t,n),u(this.behaviour(t)).push(t.exitBehavior),c(this.behaviour(t)).push(t.entryBehavior),c(this.behaviour(t)).push(function(n,i){t.region&&i.setCurrent(t.region,t)})},i.prototype.visitStateMachine=function(t,i){var e=this
n.prototype.visitStateMachine.call(this,t,i),t.accept(new l,function(t){return e.behaviour(t)}),t.onInitialise=f(this.behaviour(t))},i}(t.Visitor),g={log:function(){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},warn:function(){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},error:function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i]
throw t}}
t.console=g}(i||(i={}))
var i
!function(t){function n(t){t.accept(new o)}function i(t){return(t.region?i(t.region.state):[]).concat(t)}t.validate=n
var o=function(n){function o(){n.apply(this,arguments)}return e(o,n),o.prototype.visitPseudoState=function(i){n.prototype.visitPseudoState.call(this,i),i.kind===t.PseudoStateKind.Choice||i.kind===t.PseudoStateKind.Junction?(0===i.outgoing.length&&t.console.error(i+": "+i.kind+" pseudo states must have at least one outgoing transition."),i.outgoing.filter(function(n){return n.guard===t.Transition.FalseGuard}).length>1&&t.console.error(i+": "+i.kind+" pseudo states cannot have more than one Else transitions.")):(0!==i.outgoing.filter(function(n){return n.guard===t.Transition.FalseGuard}).length&&t.console.error(i+": "+i.kind+" pseudo states cannot have Else transitions."),i.isInitial()&&(1!==i.outgoing.length?t.console.error(i+": initial pseudo states must have one outgoing transition."):i.outgoing[0].guard!==t.Transition.TrueGuard&&t.console.error(i+": initial pseudo states cannot have a guard condition.")))},o.prototype.visitRegion=function(i){n.prototype.visitRegion.call(this,i)
var e
i.vertices.forEach(function(n){n instanceof t.PseudoState&&n.isInitial()&&(e&&t.console.error(i+": regions may have at most one initial pseudo state."),e=n)})},o.prototype.visitState=function(i){n.prototype.visitState.call(this,i),i.regions.filter(function(n){return n.name===t.Region.defaultName}).length>1&&t.console.error(i+": a state cannot have more than one region named "+t.Region.defaultName)},o.prototype.visitFinalState=function(i){n.prototype.visitFinalState.call(this,i),0!==i.outgoing.length&&t.console.error(i+": final states must not have outgoing transitions."),0!==i.regions.length&&t.console.error(i+": final states must not have child regions."),i.entryBehavior.hasActions()&&t.console.warn(i+": final states may not have entry behavior."),i.exitBehavior.hasActions()&&t.console.warn(i+": final states may not have exit behavior.")},o.prototype.visitTransition=function(e){n.prototype.visitTransition.call(this,e),e.kind===t.TransitionKind.Local&&-1===i(e.target).indexOf(e.source)&&t.console.error(e+": local transition target vertices must be a child of the source composite sate.")},o}(t.Visitor)}(i||(i={}))
var n=n
n.exports=i},{}],2:[function(t){!function(n){var i=document.currentScript
if(!i){var e=document.getElementsByTagName("script")
i=e[e.length-1]}n[i.attributes.target?i.attributes.target.textContent:"fsm"]=t("../lib/state.com.js")}(window)},{"../lib/state.com.js":1}]},{},[2])
