!function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require
if(!a&&u)return u(s,!0)
if(r)return r(s,!0)
var c=new Error("Cannot find module '"+s+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=n[s]={exports:{}}
e[s][0].call(h.exports,function(t){var n=e[s][1][t]
return o(n?n:t)},h,h.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s])
return o}({1:[function(t,e){var n,i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])
t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}
!function(t){var e=function(){function t(t){this.actions=[],t&&this.push(t)}return t.prototype.push=function(e){return Array.prototype.push.apply(this.actions,e instanceof t?e.actions:arguments),this},t.prototype.hasActions=function(){return 0!==this.actions.length},t.prototype.invoke=function(t,e,n){void 0===n&&(n=!1),this.actions.forEach(function(i){return i(t,e,n)})},t}()
t.Behavior=e}(n||(n={}))
var n
!function(t){!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(t.PseudoStateKind||(t.PseudoStateKind={}))
t.PseudoStateKind}(n||(n={}))
var n
!function(t){!function(t){t[t.Internal=0]="Internal",t[t.Local=1]="Local",t[t.External=2]="External"}(t.TransitionKind||(t.TransitionKind={}))
t.TransitionKind}(n||(n={}))
var n
!function(t){var e=function(){function t(e,n){this.name=e,this.qualifiedName=n?n.qualifiedName+t.namespaceSeparator+e:e}return t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
t.Element=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(t,n){e.call(this,t,n),this.vertices=[],this.state=n,this.state.regions.push(this),this.state.getRoot().clean=!1}return i(n,e),n.prototype.remove=function(){this.vertices.forEach(function(t){t.remove()}),this.state.regions.splice(this.state.regions.indexOf(this),1),t.console.log("remove "+this),this.state.getRoot().clean=!1},n.prototype.getRoot=function(){return this.state.getRoot()},n.prototype.accept=function(t,e,n,i){return t.visitRegion(this,e,n,i)},n.defaultName="default",n}(t.Element)
t.Region=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(n,i){e.call(this,n,i instanceof t.State?i.defaultRegion():i),this.outgoing=[],this.incoming=[],this.region=i instanceof t.State?i.defaultRegion():i instanceof t.Region?i:void 0,this.region&&(this.region.vertices.push(this),this.region.getRoot().clean=!1)}return i(n,e),n.prototype.ancestry=function(){return(this.region?this.region.state.ancestry():[]).concat(this)},n.prototype.getRoot=function(){return this.region.getRoot()},n.prototype.remove=function(){this.outgoing.forEach(function(t){t.remove()}),this.incoming.forEach(function(t){t.remove()}),this.region.vertices.splice(this.region.vertices.indexOf(this),1),t.console.log("remove "+this),this.region.getRoot().clean=!1},n.prototype.to=function(e,n){return void 0===n&&(n=t.TransitionKind.External),new t.Transition(this,e,n)},n.prototype.accept=function(){},n}(t.Element)
t.Vertex=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(n,i,o){void 0===o&&(o=t.PseudoStateKind.Initial),e.call(this,n,i),this.kind=o}return i(n,e),n.prototype.isHistory=function(){return this.kind===t.PseudoStateKind.DeepHistory||this.kind===t.PseudoStateKind.ShallowHistory},n.prototype.isInitial=function(){return this.kind===t.PseudoStateKind.Initial||this.isHistory()},n.prototype.accept=function(t,e,n,i){return t.visitPseudoState(this,e,n,i)},n}(t.Vertex)
t.PseudoState=e}(n||(n={}))
var n
!function(t){var e=function(e){function n(n,i){e.call(this,n,i),this.exitBehavior=new t.Behavior,this.entryBehavior=new t.Behavior,this.regions=[]}return i(n,e),n.prototype.defaultRegion=function(){return this.regions.reduce(function(e,n){return n.name===t.Region.defaultName?n:e},void 0)||new t.Region(t.Region.defaultName,this)},n.prototype.isFinal=function(){return 0===this.outgoing.length},n.prototype.isSimple=function(){return 0===this.regions.length},n.prototype.isComposite=function(){return this.regions.length>0},n.prototype.isOrthogonal=function(){return this.regions.length>1},n.prototype.remove=function(){this.regions.forEach(function(t){t.remove()}),e.prototype.remove.call(this)},n.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},n.prototype.entry=function(t){return this.entryBehavior.push(t),this.getRoot().clean=!1,this},n.prototype.accept=function(t,e,n,i){return t.visitState(this,e,n,i)},n}(t.Vertex)
t.State=e}(n||(n={}))
var n
!function(t){var e=function(t){function e(e,n){t.call(this,e,n)}return i(e,t),e.prototype.accept=function(t,e,n,i){return t.visitFinalState(this,e,n,i)},e}(t.State)
t.FinalState=e}(n||(n={}))
var n
!function(t){var e=function(t){function e(e){t.call(this,e,void 0),this.clean=!1}return i(e,t),e.prototype.getRoot=function(){return this.region?this.region.getRoot():this},e.prototype.accept=function(t,e,n,i){return t.visitStateMachine(this,e,n,i)},e}(t.State)
t.StateMachine=e}(n||(n={}))
var n
!function(t){var e=function(){function e(n,i,o){var r=this
void 0===o&&(o=t.TransitionKind.External),this.transitionBehavior=new t.Behavior,this.source=n,this.target=i,this.kind=i?o:t.TransitionKind.Internal,this.guard=n instanceof t.PseudoState?e.TrueGuard:function(t){return t===r.source},this.source.outgoing.push(this),this.target&&this.target.incoming.push(this),this.source.getRoot().clean=!1}return e.prototype["else"]=function(){return this.guard=e.FalseGuard,this},e.prototype.when=function(t){return this.guard=t,this},e.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.getRoot().clean=!1,this},e.prototype.remove=function(){this.source.outgoing.splice(this.source.outgoing.indexOf(this),1),this.target&&this.target.incoming.splice(this.target.incoming.indexOf(this),1),t.console.log("remove "+this),this.source.getRoot().clean=!1},e.prototype.accept=function(t,e,n,i){return t.visitTransition(this,e,n,i)},e.prototype.toString=function(){return"["+(this.target?this.source+" -> "+this.target:this.source)+"]"},e.TrueGuard=function(){return!0},e.FalseGuard=function(){return!1},e}()
t.Transition=e}(n||(n={}))
var n
!function(t){var e=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,e,n,i){var o=this,r=this.visitElement(t,e,n,i)
return t.vertices.forEach(function(t){t.accept(o,e,n,i)}),r},t.prototype.visitVertex=function(t,e,n,i){var o=this,r=this.visitElement(t,e,n,i)
return t.outgoing.forEach(function(t){t.accept(o,e,n,i)}),r},t.prototype.visitPseudoState=function(t,e,n,i){return this.visitVertex(t,e,n,i)},t.prototype.visitState=function(t,e,n,i){var o=this,r=this.visitVertex(t,e,n,i)
return t.regions.forEach(function(t){t.accept(o,e,n,i)}),r},t.prototype.visitFinalState=function(t,e,n,i){return this.visitState(t,e,n,i)},t.prototype.visitStateMachine=function(t,e,n,i){return this.visitState(t,e,n,i)},t.prototype.visitTransition=function(){},t}()
t.Visitor=e}(n||(n={}))
var n
!function(t){var e=function(){function t(t){void 0===t&&(t="unnamed"),this.last={},this.isTerminated=!1,this.name=t}return t.prototype.setCurrent=function(t,e){this.last[t.qualifiedName]=e},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
t.StateMachineInstance=e}(n||(n={}))
var n
!function(t){function e(t){i=t}function n(){return i}t.setRandom=e,t.getRandom=n
var i=function(t){return Math.floor(Math.random()*t)}}(n||(n={}))
var n
!function(t){function e(t,n){return t.region?e(t.region.state,n)&&n.getCurrent(t.region)===t:!0}t.isActive=e}(n||(n={}))
var n
!function(t){function e(n,i){return n instanceof t.Region?i.getCurrent(n).isFinal():n instanceof t.State?n.regions.every(function(t){return e(t,i)}):!0}t.isComplete=e}(n||(n={}))
var n
!function(t){function e(n,i,o){void 0===o&&(o=!0),i?(o&&n.clean===!1&&e(n),t.console.log("initialise "+i),n.onInitialise.invoke(void 0,i)):(t.console.log("initialise "+n.name),n.accept(new h,!1),n.clean=!0)}function n(n,i,r,s){return void 0===s&&(s=!0),s&&n.clean===!1&&e(n),t.console.log(i+" evaluate "+r),i.isTerminated?!1:o(n,i,r)}function o(e,n,i){var s=!1
if(e.regions.every(function(r){return o(n.getCurrent(r),n,i)?(s=!0,t.isActive(e,n)):!0}),s)i!==e&&t.isComplete(e,n)&&o(e,n,e)
else{var a=e.outgoing.filter(function(t){return t.guard(i,n)})
1===a.length?s=r(a[0],n,i):a.length>1&&t.console.error(e+": multiple outbound transitions evaluated true for message "+i)}return s}function r(e,n,i){for(var a=new t.Behavior(e.onTraverse);e.target&&e.target instanceof t.PseudoState;){var u=e.target
if(u.kind!==t.PseudoStateKind.Junction)break
e=s(u,n,i),a.push(e.onTraverse)}if(a.invoke(i,n),null!=e.target)if(e.target instanceof t.PseudoState){var u=e.target
u.kind==t.PseudoStateKind.Choice&&r(s(u,n,i),n,i)}else if(e.target instanceof t.State){var c=e.target
t.isComplete(c,n)&&o(c,n,c)}return!0}function s(e,n,i){var o=e.outgoing.filter(function(t){return t.guard(i,n)})
return e.kind===t.PseudoStateKind.Choice?0!==o.length?o[t.getRandom()(o.length)]:a(e):o.length>1?void t.console.error("Multiple outbound transition guards returned true at "+e+" for "+i):o[0]||a(e)}function a(e){return e.outgoing.filter(function(e){return e.guard===t.Transition.FalseGuard})[0]}t.initialise=e,t.evaluate=n
var u=function(){function e(){this.leave=new t.Behavior,this.beginEnter=new t.Behavior,this.endEnter=new t.Behavior}return e.prototype.enter=function(){return new t.Behavior(this.beginEnter).push(this.endEnter)},e}(),c=function(e){function n(){e.apply(this,arguments)}return i(n,e),n.prototype.visitTransition=function(e,n){e.onTraverse=new t.Behavior,e.kind===t.TransitionKind.Internal?e.onTraverse.push(e.transitionBehavior):e.kind===t.TransitionKind.Local?this.visitLocalTransition(e,n):this.visitExternalTransition(e,n)},n.prototype.visitLocalTransition=function(e,n){var i=this
e.onTraverse.push(function(o,r){for(var s=e.target.ancestry(),a=0;t.isActive(s[a],r);)++a
for(n(r.getCurrent(s[a].region)).leave.invoke(o,r),e.transitionBehavior.invoke(o,r);a<s.length;)i.cascadeElementEntry(e,n,s[a++],s[a],function(t){return t.invoke(o,r)})
n(e.target).endEnter.invoke(o,r)})},n.prototype.visitExternalTransition=function(t,e){for(var n=t.source.ancestry(),i=t.target.ancestry(),o=Math.min(n.length,i.length)-1;n[o-1]!==i[o-1];)--o
for(t.onTraverse.push(e(n[o]).leave),t.onTraverse.push(t.transitionBehavior);o<i.length;)this.cascadeElementEntry(t,e,i[o++],i[o],function(e){return t.onTraverse.push(e)})
t.onTraverse.push(e(t.target).endEnter)},n.prototype.cascadeElementEntry=function(e,n,i,o,r){if(r(n(i).beginEnter),o&&i instanceof t.State){var s=i
s.regions.forEach(function(t){r(n(t).beginEnter),t!==o.region&&r(n(t).endEnter)})}},n}(t.Visitor),h=function(e){function n(){e.apply(this,arguments),this.behaviors={}}return i(n,e),n.prototype.behavior=function(t){return this.behaviors[t.qualifiedName]||(this.behaviors[t.qualifiedName]=new u)},n.prototype.visitElement=function(e){t.console!==f&&(this.behavior(e).leave.push(function(n,i){return t.console.log(i+" leave "+e)}),this.behavior(e).beginEnter.push(function(n,i){return t.console.log(i+" enter "+e)}))},n.prototype.visitRegion=function(e,n){var i=this,o=e.vertices.reduce(function(e,n){return n instanceof t.PseudoState&&n.isInitial()?n:e},void 0)
e.vertices.forEach(function(e){return e.accept(i,n||o&&o.kind===t.PseudoStateKind.DeepHistory)}),this.behavior(e).leave.push(function(t,n){return i.behavior(n.getCurrent(e)).leave.invoke(t,n)}),this.behavior(e).endEnter.push(n||!o||o.isHistory()?function(n,r,s){return i.behavior(s||o.isHistory()?r.getCurrent(e)||o:o).enter().invoke(n,r,s||o.kind===t.PseudoStateKind.DeepHistory)}:this.behavior(o).enter()),this.visitElement(e,n)},n.prototype.visitPseudoState=function(n,i){e.prototype.visitPseudoState.call(this,n,i),n.isInitial()?this.behavior(n).endEnter.push(function(t,e){return r(n.outgoing[0],e)}):n.kind===t.PseudoStateKind.Terminate&&this.behavior(n).beginEnter.push(function(t,e){return e.isTerminated=!0})},n.prototype.visitState=function(t,e){var n=this
t.regions.forEach(function(i){i.accept(n,e),n.behavior(t).leave.push(n.behavior(i).leave),n.behavior(t).endEnter.push(n.behavior(i).enter())}),this.visitVertex(t,e),this.behavior(t).leave.push(t.exitBehavior),this.behavior(t).beginEnter.push(t.entryBehavior),this.behavior(t).beginEnter.push(function(e,n){t.region&&n.setCurrent(t.region,t)})},n.prototype.visitStateMachine=function(t,n){var i=this
e.prototype.visitStateMachine.call(this,t,n),t.accept(new c,function(t){return i.behavior(t)}),t.onInitialise=this.behavior(t).enter()},n}(t.Visitor),f={log:function(){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e]},warn:function(){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e]},error:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]
throw t}}
t.console=f}(n||(n={}))
var n
!function(t){function e(t){t.accept(new n)}t.validate=e
var n=function(e){function n(){e.apply(this,arguments)}return i(n,e),n.prototype.visitPseudoState=function(n){e.prototype.visitPseudoState.call(this,n),n.kind===t.PseudoStateKind.Choice||n.kind===t.PseudoStateKind.Junction?(0===n.outgoing.length&&t.console.error(n+": "+n.kind+" pseudo states must have at least one outgoing transition."),n.outgoing.filter(function(e){return e.guard===t.Transition.FalseGuard}).length>1&&t.console.error(n+": "+n.kind+" pseudo states cannot have more than one Else transitions.")):(0!==n.outgoing.filter(function(e){return e.guard===t.Transition.FalseGuard}).length&&t.console.error(n+": "+n.kind+" pseudo states cannot have Else transitions."),n.isInitial()&&(1!==n.outgoing.length?t.console.error(n+": initial pseudo states must have one outgoing transition."):n.outgoing[0].guard!==t.Transition.TrueGuard&&t.console.error(n+": initial pseudo states cannot have a guard condition.")))},n.prototype.visitRegion=function(n){e.prototype.visitRegion.call(this,n)
var i
n.vertices.forEach(function(e){e instanceof t.PseudoState&&e.isInitial()&&(i&&t.console.error(n+": regions may have at most one initial pseudo state."),i=e)})},n.prototype.visitState=function(n){e.prototype.visitState.call(this,n),n.regions.filter(function(e){return e.name===t.Region.defaultName}).length>1&&t.console.error(n+": a state cannot have more than one region named "+t.Region.defaultName)},n.prototype.visitFinalState=function(n){e.prototype.visitFinalState.call(this,n),0!==n.outgoing.length&&t.console.error(n+": final states must not have outgoing transitions."),0!==n.regions.length&&t.console.error(n+": final states must not have child regions."),n.entryBehavior.hasActions()&&t.console.warn(n+": final states may not have entry behavior."),n.exitBehavior.hasActions()&&t.console.warn(n+": final states may not have exit behavior.")},n.prototype.visitTransition=function(n){e.prototype.visitTransition.call(this,n),n.kind===t.TransitionKind.Local&&-1===n.target.ancestry().indexOf(n.source)&&t.console.error(n+": local transition target vertices must be a child of the source composite sate.")},n}(t.Visitor)}(n||(n={}))
var e=e
e.exports=n},{}],2:[function(t){!function(e){var n=document.currentScript
if(!n){var i=document.getElementsByTagName("script")
n=i[i.length-1]}var o=n.attributes.target?n.attributes.target.textContent:"fsm"
e[o]=t("../lib/state.com.js")}(window)},{"../lib/state.com.js":1}]},{},[2])
