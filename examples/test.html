<!DOCTYPE html>
<html lang="en">
	<head>
		<title>state.js example</title>
		<script src="../src/oldie.js"></script>
		<script src="../src/state.js"></script>
		<script>
		
			var running = { kind: Kind.State, name: "running", entry: [ StartMotor ], exit: [ StopMotor ]  };
			var paused = { kind: Kind.State, name: "paused" };
			
			var initial2 = { kind: Kind.Initial, name: "initial2" };
			var stopped = { kind: Kind.State, name: "stopped" };
			var active = { kind: Kind.State, name: "active", children: [ running, paused ], entry: [ EngageHead ], exit: [ DisengageHead ] };

			var initial1 = { kind: Kind.Initial, name: "initial1" };
			var operational = { kind: Kind.State, name: "operational", children: [ initial2, stopped, active ] };
			var finalState = { kind: Kind.Final, name: "final" };
			
			controller = createStateMachine( { kind: Kind.Region, name: "player", children: [ initial1, operational, finalState ] },
			                                   [ { kind: Kind.Completion, source: initial1,    target: operational, effect: [ StopMotor, DisengageHead ] },
			                                     { kind: Kind.Completion, source: initial2,    target: stopped },
			                                     { kind: Kind.Transition, source: stopped,     target: running, guard: function( s ) { return ( s == 'play' ); } },
			                                     { kind: Kind.Transition, source: active,      target: stopped, guard: function( s ) { return s == 'stop'; } },
			                                     { kind: Kind.Transition, source: running,     target: paused, guard: function( s ) { return s == 'pause'; } },
			                                     { kind: Kind.Transition, source: paused,      target: running, guard: function( s ) { return s == 'play'; } },
			                                     { kind: Kind.Transition, source: operational, target: finalState, guard: function( s ) { return s == 'off'; } } ] );

			function EngageHead()
			{
				document.getElementById("head").innerHTML = "Head: engaged";
			}
			
			function DisengageHead()
			{
				document.getElementById("head").innerHTML = "Head: disengaged";
			}
			
			function StartMotor()
			{
				document.getElementById("motor").innerHTML = "Motor: running";
			}
			
			function StopMotor()
			{
				document.getElementById("motor").innerHTML = "Motor: stopped";
			}
			
			// a little more behavior to adjust the graphic
			stopped.entry = [ function() { UpdateGraphic( "controller_stopped.png" ); } ];
			running.entry.push( function() { UpdateGraphic( "controller_running.png" ); } );
			paused.entry = [ function() { UpdateGraphic( "controller_paused.png" ); } ];
			operational.exit = [ function() { UpdateGraphic( "controller_final.png" ); } ];
			
			function UpdateGraphic( uri )
			{
				document.getElementById( "diagram" ).src = uri;
			}
			</script>
	</head>
	<body onload="controller.initialise()">
		<h1>state.js cassette controller example</h1>
		<p>This example implements a simple controller for a cassette player according to the model below:</p>
		<p><img id="diagram" /></p>
		<p>Press the buttons below to send events to the controller (check brower console for trace output):</p>
		<button type="button" onclick="controller.process( 'play' )">Play</button>
		<button type="button" onclick="controller.process( 'pause' )">Pause</button>
		<button type="button" onclick="controller.process( 'stop' )">Stop</button>
		<button type="button" onclick="controller.process( 'off' )">Off</button>
		<p id="head">Head: </p>
		<p id="motor">Motor: </p>
	</body>
</html>