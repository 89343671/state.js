!function t(n,e,i){function o(a,s){if(!e[a]){if(!n[a]){var u="function"==typeof require&&require
if(!s&&u)return u(a,!0)
if(r)return r(a,!0)
var c=new Error("Cannot find module '"+a+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=e[a]={exports:{}}
n[a][0].call(h.exports,function(t){var e=n[a][1][t]
return o(e?e:t)},h,h.exports,t,n,e,i)}return e[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a])
return o}({1:[function(t,n){var e
!function(t){!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(t.PseudoStateKind||(t.PseudoStateKind={}))
t.PseudoStateKind}(e||(e={}))
var e
!function(t){!function(t){t[t.Internal=0]="Internal",t[t.Local=1]="Local",t[t.External=2]="External"}(t.TransitionKind||(t.TransitionKind={}))
t.TransitionKind}(e||(e={}))
var e
!function(t){var n=function(){function t(t,n){this.name=t,this.qualifiedName=n?n.qualifiedName+"."+t:t}return t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
t.Element=n}(e||(e={}))
var e,i=this.__extends||function(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])
e.prototype=n.prototype,t.prototype=new e}
!function(t){var n=function(n){function e(t,e){n.call(this,t,e),this.vertices=[],this.state=e,this.state.regions.push(this),this.state.getRoot().clean=!1}return i(e,n),e.prototype.getRoot=function(){return this.state.getRoot()},e.prototype.getInitial=function(){var n,e=this
return this.vertices.forEach(function(i){i instanceof t.PseudoState&&i.isInitial()&&(n&&e.getRoot().errorTo.error("Multiple initial pseudo states defined for region: "+e.qualifiedName),n=i)}),n},e.prototype.accept=function(t,n,e,i){return t.visitRegion(this,n,e,i)},e.defaultName="default",e}(t.Element)
t.Region=n}(e||(e={}))
var e
!function(t){var n=function(n){function e(e,i){n.call(this,e,i=i instanceof t.State?i.defaultRegion():i),this.outgoing=[],(this.region=i)&&(this.region.vertices.push(this),this.region.getRoot().clean=!1)}return i(e,n),e.prototype.getRoot=function(){return this.region.getRoot()},e.prototype.to=function(n,e){return void 0===e&&(e=t.TransitionKind.External),new t.Transition(this,n,n?e:t.TransitionKind.Internal)},e.prototype.accept=function(){},e}(t.Element)
t.Vertex=n}(e||(e={}))
var e
!function(t){var n=function(n){function e(e,i,o){void 0===o&&(o=t.PseudoStateKind.Initial),n.call(this,e,i),this.kind=o}return i(e,n),e.prototype.isHistory=function(){return this.kind===t.PseudoStateKind.DeepHistory||this.kind===t.PseudoStateKind.ShallowHistory},e.prototype.isInitial=function(){return this.kind===t.PseudoStateKind.Initial||this.isHistory()},e.prototype.accept=function(t,n,e,i){return t.visitPseudoState(this,n,e,i)},e}(t.Vertex)
t.PseudoState=n}(e||(e={}))
var e
!function(t){var n=function(n){function e(t,e){n.call(this,t,e),this.exitBehavior=[],this.entryBehavior=[],this.regions=[]}return i(e,n),e.prototype.defaultRegion=function(){var n
return this.regions.forEach(function(e){e.name===t.Region.defaultName&&(n=e)}),n||(n=new t.Region(t.Region.defaultName,this)),n},e.prototype.isFinal=function(){return 0===this.outgoing.length},e.prototype.isSimple=function(){return 0===this.regions.length},e.prototype.isComposite=function(){return this.regions.length>0},e.prototype.isOrthogonal=function(){return this.regions.length>1},e.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},e.prototype.entry=function(t){return this.entryBehavior.push(t),this.getRoot().clean=!1,this},e.prototype.accept=function(t,n,e,i){return t.visitState(this,n,e,i)},e}(t.Vertex)
t.State=n}(e||(e={}))
var e
!function(t){var n=function(t){function n(n,e){t.call(this,n,e)}return i(n,t),n.prototype.to=function(){this.getRoot().warnTo.warn("A FinalState cannot be the source of a transition; transition not accepted")},n.prototype.accept=function(t,n,e,i){return t.visitFinalState(this,n,e,i)},n}(t.State)
t.FinalState=n}(e||(e={}))
var e
!function(t){var n=function(n){function e(e){n.call(this,e,void 0),this.clean=!1,this.logTo=t.defaultConsole,this.warnTo=t.defaultConsole,this.errorTo=t.defaultConsole}return i(e,n),e.prototype.getRoot=function(){return this.region?this.region.getRoot():this},e.prototype.setLogger=function(t){return this.logTo=t,this.clean=!1,this},e.prototype.setWarning=function(t){return this.warnTo=t,this.clean=!1,this},e.prototype.setError=function(t){return this.errorTo=t,this.clean=!1,this},e.prototype.accept=function(t,n,e,i){return t.visitStateMachine(this,n,e,i)},e}(t.State)
t.StateMachine=n,t.defaultConsole={log:function(){},warn:function(){},error:function(t){throw t}}}(e||(e={}))
var e
!function(t){var n=function(){function n(n,e,i){var o=this
if(void 0===i&&(i=t.TransitionKind.External),this.source=n,this.target=e,this.transitionBehavior=[],this.traverse=[],this.guard=n instanceof t.PseudoState?function(){return!0}:function(t){return t===o.source},this.kind=e?i:t.TransitionKind.Internal,this.kind===t.TransitionKind.Local){var r=e
do if(r===n)return
while(r=r.region?r.region.state:void 0)
n.getRoot().errorTo.error(e+" is not a descendant of "+n)}this.source.outgoing.push(this),this.source.getRoot().clean=!1}return n.prototype["else"]=function(){return this.guard=n.isElse,this},n.prototype.when=function(t){return this.guard=t,this},n.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.getRoot().clean=!1,this},n.prototype.accept=function(t,n,e,i){return t.visitTransition(this,n,e,i)},n.isElse=function(){return!1},n}()
t.Transition=n}(e||(e={}))
var e
!function(t){var n=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,n,e,i){var o=this,r=this.visitElement(t,n,e,i)
return t.vertices.forEach(function(t){t.accept(o,n,e,i)}),r},t.prototype.visitVertex=function(t,n,e,i){var o=this,r=this.visitElement(t,n,e,i)
return t.outgoing.forEach(function(t){t.accept(o,n,e,i)}),r},t.prototype.visitPseudoState=function(t,n,e,i){return this.visitVertex(t,n,e,i)},t.prototype.visitState=function(t,n,e,i){var o=this,r=this.visitVertex(t,n,e,i)
return t.regions.forEach(function(t){t.accept(o,n,e,i)}),r},t.prototype.visitFinalState=function(t,n,e,i){return this.visitState(t,n,e,i)},t.prototype.visitStateMachine=function(t,n,e,i){return this.visitState(t,n,e,i)},t.prototype.visitTransition=function(){},t}()
t.Visitor=n}(e||(e={}))
var e
!function(t){var n=function(){function t(t){void 0===t&&(t="unnamed"),this.name=t,this.last={},this.isTerminated=!1}return t.prototype.setCurrent=function(t,n){this.last[t.qualifiedName]=n},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
t.StateMachineInstance=n}(e||(e={}))
var e
!function(t){function n(t){i=t}function e(){return i}t.setRandom=n,t.getRandom=e
var i=function(t){return Math.floor(Math.random()*t)}}(e||(e={}))
var e
!function(t){function n(e,i){return e instanceof t.Region?n(e.state,i):e instanceof t.State?e.region?n(e.region,i)&&i.getCurrent(e.region)===e:!0:void 0}t.isActive=n}(e||(e={}))
var e
!function(t){function n(e,i){return e instanceof t.Region?i.getCurrent(e).isFinal():e instanceof t.State?e.regions.every(function(t){return n(t,i)}):!0}t.isComplete=n}(e||(e={}))
var e
!function(t){function n(t,e,i){void 0===i&&(i=!0),e?(i&&t.clean===!1&&n(t),t.logTo.log("initialise "+e),t.onInitialise.forEach(function(t){return t(void 0,e)})):(t.logTo.log("initialise "+t.name),t.accept(new h,!1),t.clean=!0)}function e(t,e,i,r){return void 0===r&&(r=!0),t.logTo.log(e+" evaluate "+i),r&&t.clean===!1&&n(t),e.isTerminated?!1:o(t,e,i)}function o(n,e,i){var a=!1
if(n.regions.every(function(r){return o(e.getCurrent(r),e,i)&&(a=!0,!t.isActive(n,e))?!1:!0}),a)i!==n&&t.isComplete(n,e)&&o(n,e,n)
else{var s
n.outgoing.forEach(function(t){t.guard(i,e)&&(s&&n.getRoot().errorTo.error("Multiple outbound transitions evaluated true"),s=t)}),s&&(a=r(s,e,i))}return a}function r(n,e,i){for(var s=n.traverse,u=n.target;u&&u instanceof t.PseudoState&&u.kind===t.PseudoStateKind.Junction;)n=a(u,e,i),u=n.target,Array.prototype.push.apply(s,n.traverse)
return s.forEach(function(t){return t(i,e)}),u&&u instanceof t.PseudoState&&u.kind===t.PseudoStateKind.Choice?r(a(u,e,i),e,i):u&&u instanceof t.State&&t.isComplete(u,e)&&o(u,e,u),!0}function a(n,e,i){var o,r=this,a=[]
return n.outgoing.forEach(function(s){s.guard===t.Transition.isElse?(o&&n.getRoot().errorTo.error("Multiple outbound else transitions found at "+r+" for "+i),o=s):s.guard(i,e)&&a.push(s)}),n.kind===t.PseudoStateKind.Choice?0!==a.length?a[t.getRandom()(a.length)]:o:n.kind===t.PseudoStateKind.Junction?(a.length>1&&n.getRoot().errorTo.error("Multiple outbound transition guards returned true at "+this+" for "+i),a[0]||o):void 0}function s(t){return(t.region?s(t.region.state).concat(t.region):[]).concat(t)}t.initialise=n,t.evaluate=e
var u=function(){function t(){this.leave=[],this.beginEnter=[],this.endEnter=[],this.enter=[]}return t}(),c=function(n){function e(){n.apply(this,arguments)}return i(e,n),e.prototype.visitTransition=function(n,e){switch(n.kind){case t.TransitionKind.Internal:n.traverse=n.transitionBehavior
break
case t.TransitionKind.Local:this.visitLocalTransition(n,e)
break
case t.TransitionKind.External:this.visitExternalTransition(n,e)}},e.prototype.visitLocalTransition=function(n,e){var i=this
n.traverse.push(function(o,r){for(var a=s(n.target),u=0;t.isActive(a[u],r);)u++
for(e[r.getCurrent(a[u].region).qualifiedName].leave.forEach(function(t){return t(o,r)}),n.transitionBehavior.forEach(function(t){return t(o,r)});u<a.length;)i.cascadeElementEntry(n,e,a[u++],u<a.length?a[u]:void 0,function(t){t.forEach(function(t){return t(o,r)})})
e[n.target.qualifiedName].endEnter.forEach(function(t){return t(o,r)})})},e.prototype.visitExternalTransition=function(t,n){for(var e=s(t.source),i=s(t.target),o=Math.min(e.length,i.length)-1;e[o-1]!==i[o-1];)o--
for(Array.prototype.push.apply(t.traverse,n[e[o].qualifiedName].leave),Array.prototype.push.apply(t.traverse,t.transitionBehavior);o<i.length;)this.cascadeElementEntry(t,n,i[o++],i[o],function(n){Array.prototype.push.apply(t.traverse,n)})
Array.prototype.push.apply(t.traverse,n[t.target.qualifiedName].endEnter)},e.prototype.cascadeElementEntry=function(n,e,i,o,r){r(e[i.qualifiedName].beginEnter),o&&i instanceof t.State&&i.isOrthogonal()&&i.regions.forEach(function(t){t!==o&&r(e[t.qualifiedName].enter)})},e}(t.Visitor),h=function(n){function e(){n.apply(this,arguments),this.behaviours={}}return i(e,n),e.prototype.behaviour=function(t){return this.behaviours[t.qualifiedName]||(this.behaviours[t.qualifiedName]=new u)},e.prototype.visitRegion=function(n,e){var i=this,o=this.behaviour(n),r=n.getInitial()
n.vertices.forEach(function(n){return n.accept(i,e||r&&r.kind===t.PseudoStateKind.DeepHistory)}),o.leave.push(function(t,e){return i.behaviour(e.getCurrent(n)).leave.forEach(function(n){return n(t,e)})}),e||!r||r.isHistory()?o.endEnter.push(function(e,o,a){i.behaviour(a||r.isHistory()?o.getCurrent(n)||r:r).enter.forEach(function(n){return n(e,o,a||r.kind===t.PseudoStateKind.DeepHistory)})}):Array.prototype.push.apply(o.endEnter,this.behaviour(r).enter),n.getRoot().logTo!==t.defaultConsole&&(o.leave.push(function(t,e){return n.getRoot().logTo.log(e+" leave "+n)}),o.beginEnter.push(function(t,e){return n.getRoot().logTo.log(e+" enter "+n)})),o.enter=o.beginEnter.concat(o.endEnter)},e.prototype.visitVertex=function(n){if(n.getRoot().logTo!==t.defaultConsole){var e=this.behaviour(n)
e.leave.push(function(t,e){return n.getRoot().logTo.log(e+" leave "+n)}),e.beginEnter.push(function(t,e){return n.getRoot().logTo.log(e+" enter "+n)})}},e.prototype.visitPseudoState=function(n,e){var i=this.behaviour(n)
this.visitVertex(n,e),n.isInitial()?this.behaviour(n).endEnter.push(function(t,e){return r(n.outgoing[0],e)}):n.kind===t.PseudoStateKind.Terminate&&i.beginEnter.push(function(t,n){return n.isTerminated=!0}),i.enter=i.beginEnter.concat(i.endEnter)},e.prototype.visitState=function(t,n){var e=this,i=this.behaviour(t)
t.regions.forEach(function(t){var o=e.behaviour(t)
t.accept(e,n),Array.prototype.push.apply(i.leave,o.leave),Array.prototype.push.apply(i.endEnter,o.enter)}),this.visitVertex(t,n),Array.prototype.push.apply(i.leave,t.exitBehavior),Array.prototype.push.apply(i.beginEnter,t.entryBehavior),i.beginEnter.push(function(n,e){t.region&&e.setCurrent(t.region,t)}),i.enter=i.beginEnter.concat(i.endEnter)},e.prototype.visitStateMachine=function(t,n){this.visitState(t,n),t.accept(new c,this.behaviours),t.onInitialise=this.behaviour(t).enter},e}(t.Visitor)}(e||(e={}))
var n=n
n.exports=e},{}],2:[function(t){!function(n){var e=document.currentScript
if(!e){var i=document.getElementsByTagName("script")
e=i[i.length-1]}n[e.attributes.target?e.attributes.target.textContent:"fsm"]=t("../lib/state.com.js")}(window)},{"../lib/state.com.js":1}]},{},[2])
