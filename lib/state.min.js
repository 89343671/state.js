!function t(n,e,i){function o(a,s){if(!e[a]){if(!n[a]){var u="function"==typeof require&&require
if(!s&&u)return u(a,!0)
if(r)return r(a,!0)
var c=new Error("Cannot find module '"+a+"'")
throw c.code="MODULE_NOT_FOUND",c}var h=e[a]={exports:{}}
n[a][0].call(h.exports,function(t){var e=n[a][1][t]
return o(e?e:t)},h,h.exports,t,n,e,i)}return e[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a])
return o}({1:[function(t,n){var e
!function(t){!function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(t.PseudoStateKind||(t.PseudoStateKind={}))
t.PseudoStateKind}(e||(e={}))
var e
!function(t){!function(t){t[t.Internal=0]="Internal",t[t.Local=1]="Local",t[t.External=2]="External"}(t.TransitionKind||(t.TransitionKind={}))
t.TransitionKind}(e||(e={}))
var e
!function(t){var n=function(){function t(t,n){this.name=t,this.qualifiedName=n?n.qualifiedName+"."+t:t}return t.prototype.toString=function(){return this.qualifiedName},t.namespaceSeparator=".",t}()
t.Element=n}(e||(e={}))
var e,i=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])
e.prototype=n.prototype,t.prototype=new e}
!function(t){var n=function(t){function n(n,e){t.call(this,n,e),this.vertices=[],this.state=e,this.state.regions.push(this),this.state.getRoot().clean=!1}return i(n,t),n.prototype.getRoot=function(){return this.state.getRoot()},n.prototype.accept=function(t,n,e,i){return t.visitRegion(this,n,e,i)},n.defaultName="default",n}(t.Element)
t.Region=n}(e||(e={}))
var e
!function(t){var n=function(n){function e(e,i){n.call(this,e,i=i instanceof t.State?i.defaultRegion():i),this.outgoing=[],this.region=i,this.region&&(this.region.vertices.push(this),this.region.getRoot().clean=!1)}return i(e,n),e.prototype.getRoot=function(){return this.region.getRoot()},e.prototype.to=function(n,e){return void 0===e&&(e=t.TransitionKind.External),new t.Transition(this,n,e)},e.prototype.accept=function(){},e}(t.Element)
t.Vertex=n}(e||(e={}))
var e
!function(t){var n=function(n){function e(e,i,o){void 0===o&&(o=t.PseudoStateKind.Initial),n.call(this,e,i),this.kind=o}return i(e,n),e.prototype.isHistory=function(){return this.kind===t.PseudoStateKind.DeepHistory||this.kind===t.PseudoStateKind.ShallowHistory},e.prototype.isInitial=function(){return this.kind===t.PseudoStateKind.Initial||this.isHistory()},e.prototype.accept=function(t,n,e,i){return t.visitPseudoState(this,n,e,i)},e}(t.Vertex)
t.PseudoState=n}(e||(e={}))
var e
!function(t){var n=function(n){function e(t,e){n.call(this,t,e),this.exitBehavior=[],this.entryBehavior=[],this.regions=[]}return i(e,n),e.prototype.defaultRegion=function(){return this.regions.reduce(function(n,e){return e.name===t.Region.defaultName?e:n},void 0)||new t.Region(t.Region.defaultName,this)},e.prototype.isFinal=function(){return 0===this.outgoing.length},e.prototype.isSimple=function(){return 0===this.regions.length},e.prototype.isComposite=function(){return this.regions.length>0},e.prototype.isOrthogonal=function(){return this.regions.length>1},e.prototype.exit=function(t){return this.exitBehavior.push(t),this.getRoot().clean=!1,this},e.prototype.entry=function(t){return this.entryBehavior.push(t),this.getRoot().clean=!1,this},e.prototype.accept=function(t,n,e,i){return t.visitState(this,n,e,i)},e}(t.Vertex)
t.State=n}(e||(e={}))
var e
!function(t){var n=function(t){function n(n,e){t.call(this,n,e)}return i(n,t),n.prototype.accept=function(t,n,e,i){return t.visitFinalState(this,n,e,i)},n}(t.State)
t.FinalState=n}(e||(e={}))
var e
!function(t){var n=function(t){function n(n){t.call(this,n,void 0),this.clean=!1}return i(n,t),n.prototype.getRoot=function(){return this.region?this.region.getRoot():this},n.prototype.accept=function(t,n,e,i){return t.visitStateMachine(this,n,e,i)},n}(t.State)
t.StateMachine=n}(e||(e={}))
var e
!function(t){var n=function(){function n(e,i,o){var r=this
void 0===o&&(o=t.TransitionKind.External),this.source=e,this.target=i,this.transitionBehavior=[],this.onTraverse=[],this.guard=e instanceof t.PseudoState?n.TrueGuard:function(t){return t===r.source},this.kind=i?o:t.TransitionKind.Internal,this.source.outgoing.push(this),this.source.getRoot().clean=!1}return n.prototype["else"]=function(){return this.guard=n.FalseGuard,this},n.prototype.when=function(t){return this.guard=t,this},n.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.getRoot().clean=!1,this},n.prototype.accept=function(t,n,e,i){return t.visitTransition(this,n,e,i)},n.prototype.toString=function(){return"["+(this.target?this.source+" -> "+this.target:this.source)+"]"},n.TrueGuard=function(){return!0},n.FalseGuard=function(){return!1},n}()
t.Transition=n}(e||(e={}))
var e
!function(t){var n=function(){function t(){}return t.prototype.visitElement=function(){},t.prototype.visitRegion=function(t,n,e,i){var o=this,r=this.visitElement(t,n,e,i)
return t.vertices.forEach(function(t){t.accept(o,n,e,i)}),r},t.prototype.visitVertex=function(t,n,e,i){var o=this,r=this.visitElement(t,n,e,i)
return t.outgoing.forEach(function(t){t.accept(o,n,e,i)}),r},t.prototype.visitPseudoState=function(t,n,e,i){return this.visitVertex(t,n,e,i)},t.prototype.visitState=function(t,n,e,i){var o=this,r=this.visitVertex(t,n,e,i)
return t.regions.forEach(function(t){t.accept(o,n,e,i)}),r},t.prototype.visitFinalState=function(t,n,e,i){return this.visitState(t,n,e,i)},t.prototype.visitStateMachine=function(t,n,e,i){return this.visitState(t,n,e,i)},t.prototype.visitTransition=function(){},t}()
t.Visitor=n}(e||(e={}))
var e
!function(t){var n=function(){function t(t){void 0===t&&(t="unnamed"),this.name=t,this.last={},this.isTerminated=!1}return t.prototype.setCurrent=function(t,n){this.last[t.qualifiedName]=n},t.prototype.getCurrent=function(t){return this.last[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}()
t.StateMachineInstance=n}(e||(e={}))
var e
!function(t){function n(t){i=t}function e(){return i}t.setRandom=n,t.getRandom=e
var i=function(t){return Math.floor(Math.random()*t)}}(e||(e={}))
var e
!function(t){function n(e,i){return e instanceof t.Region?n(e.state,i):e instanceof t.State?e.region?n(e.region,i)&&i.getCurrent(e.region)===e:!0:void 0}t.isActive=n}(e||(e={}))
var e
!function(t){function n(e,i){return e instanceof t.Region?i.getCurrent(e).isFinal():e instanceof t.State?e.regions.every(function(t){return n(t,i)}):!0}t.isComplete=n}(e||(e={}))
var e
!function(t){function n(t,n,e,i){void 0===i&&(i=!1),t.forEach(function(t){return t(n,e,i)})}function e(i,o,r){void 0===r&&(r=!0),o?(r&&i.clean===!1&&e(i),t.console.log("initialise "+o),n(i.onInitialise,void 0,o)):(t.console.log("initialise "+i.name),i.accept(new l,!1),i.clean=!0)}function o(n,i,o,a){return void 0===a&&(a=!0),t.console.log(i+" evaluate "+o),a&&n.clean===!1&&e(n),i.isTerminated?!1:r(n,i,o)}function r(n,e,i){var o=!1
if(n.regions.every(function(a){return r(e.getCurrent(a),e,i)?(o=!0,t.isActive(n,e)):!0}),o)i!==n&&t.isComplete(n,e)&&r(n,e,n)
else{var s=n.outgoing.filter(function(t){return t.guard(i,e)})
1===s.length?o=a(s[0],e,i):s.length>1&&t.console.error(n+": multiple outbound transitions evaluated true for message "+i)}return o}function a(e,i,o){for(var u=e.onTraverse,c=e.target;c&&c instanceof t.PseudoState&&c.kind===t.PseudoStateKind.Junction;)c=(e=s(c,i,o)).target,Array.prototype.push.apply(u,e.onTraverse)
return n(u,o,i),c&&c instanceof t.PseudoState&&c.kind===t.PseudoStateKind.Choice?a(s(c,i,o),i,o):c&&c instanceof t.State&&t.isComplete(c,i)&&r(c,i,c),!0}function s(n,e,i){var o=n.outgoing.filter(function(t){return t.guard(i,e)})
return n.kind===t.PseudoStateKind.Choice?0!==o.length?o[t.getRandom()(o.length)]:u(n):o.length>1?void t.console.error("Multiple outbound transition guards returned true at "+this+" for "+i):o[0]||u(n)}function u(n){return n.outgoing.filter(function(n){return n.guard===t.Transition.FalseGuard})[0]}function c(t){return(t.region?c(t.region.state):[]).concat(t)}t.initialise=e,t.evaluate=o
var h=function(){function t(){this.leave=[],this.beginEnter=[],this.endEnter=[]}return t.prototype.enter=function(){return this.beginEnter.concat(this.endEnter)},t}(),p=function(e){function o(){e.apply(this,arguments)}return i(o,e),o.prototype.visitTransition=function(n,e){n.kind===t.TransitionKind.Internal?n.onTraverse=n.transitionBehavior:n.kind===t.TransitionKind.Local?this.visitLocalTransition(n,e):this.visitExternalTransition(n,e)},o.prototype.visitLocalTransition=function(e,i){var o=this
e.onTraverse.push(function(r,a){for(var s=c(e.target),u=0;t.isActive(s[u],a);)++u
for(n(i(a.getCurrent(s[u].region)).leave,r,a),n(e.transitionBehavior,r,a);u<s.length;)o.cascadeElementEntry(e,i,s[u++],s[u],function(t){n(t,r,a)})
n(i(e.target).endEnter,r,a)})},o.prototype.visitExternalTransition=function(t,n){for(var e=c(t.source),i=c(t.target),o=Math.min(e.length,i.length)-1;e[o-1]!==i[o-1];)--o
for(Array.prototype.push.apply(t.onTraverse,n(e[o]).leave),Array.prototype.push.apply(t.onTraverse,t.transitionBehavior);o<i.length;)this.cascadeElementEntry(t,n,i[o++],i[o],function(n){Array.prototype.push.apply(t.onTraverse,n)})
Array.prototype.push.apply(t.onTraverse,n(t.target).endEnter)},o.prototype.cascadeElementEntry=function(n,e,i,o,r){r(e(i).beginEnter),o&&i instanceof t.State&&i.regions.forEach(function(t){r(e(t).beginEnter),t!==o.region&&r(e(t).endEnter)})},o}(t.Visitor),l=function(e){function o(){e.apply(this,arguments),this.behaviours={}}return i(o,e),o.prototype.behaviour=function(t){return this.behaviours[t.qualifiedName]||(this.behaviours[t.qualifiedName]=new h)},o.prototype.addLogging=function(t,n){n!==f&&(this.behaviour(t).leave.push(function(e,i){return n.log(i+" leave "+t)}),this.behaviour(t).beginEnter.push(function(e,i){return n.log(i+" enter "+t)}))},o.prototype.visitRegion=function(i,o){var r=this,a=i.vertices.reduce(function(n,e){return e instanceof t.PseudoState&&e.isInitial()?e:n},void 0)
e.prototype.visitRegion.call(this,i,o||a&&a.kind===t.PseudoStateKind.DeepHistory),this.behaviour(i).leave.push(function(t,e){return n(r.behaviour(e.getCurrent(i)).leave,t,e)}),o||!a||a.isHistory()?this.behaviour(i).endEnter.push(function(e,o,s){n(r.behaviour(s||a.isHistory()?o.getCurrent(i)||a:a).enter(),e,o,s||a.kind===t.PseudoStateKind.DeepHistory)}):Array.prototype.push.apply(this.behaviour(i).endEnter,this.behaviour(a).enter()),this.addLogging(i,t.console)},o.prototype.visitVertex=function(n){this.addLogging(n,t.console)},o.prototype.visitPseudoState=function(n,i){e.prototype.visitPseudoState.call(this,n,i),n.isInitial()?this.behaviour(n).endEnter.push(function(t,e){return a(n.outgoing[0],e)}):n.kind===t.PseudoStateKind.Terminate&&this.behaviour(n).beginEnter.push(function(t,n){return n.isTerminated=!0})},o.prototype.visitState=function(t,n){var e=this
t.regions.forEach(function(i){i.accept(e,n),Array.prototype.push.apply(e.behaviour(t).leave,e.behaviour(i).leave),Array.prototype.push.apply(e.behaviour(t).endEnter,e.behaviour(i).enter())}),this.visitVertex(t,n),Array.prototype.push.apply(this.behaviour(t).leave,t.exitBehavior),Array.prototype.push.apply(this.behaviour(t).beginEnter,t.entryBehavior),this.behaviour(t).beginEnter.push(function(n,e){t.region&&e.setCurrent(t.region,t)})},o.prototype.visitStateMachine=function(t,n){var i=this
e.prototype.visitStateMachine.call(this,t,n),t.accept(new p,function(t){return i.behaviour(t)}),t.onInitialise=this.behaviour(t).enter()},o}(t.Visitor),f={log:function(){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},warn:function(){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},error:function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e]
throw t}}
t.console=f}(e||(e={}))
var e
!function(t){function n(t){t.accept(new o)}function e(t){return(t.region?e(t.region.state):[]).concat(t)}t.validate=n
var o=function(n){function o(){n.apply(this,arguments)}return i(o,n),o.prototype.visitPseudoState=function(e){n.prototype.visitPseudoState.call(this,e),e.kind===t.PseudoStateKind.Choice||e.kind===t.PseudoStateKind.Junction?(0===e.outgoing.length&&t.console.error(e+": "+e.kind+" pseudo states must have at least one outgoing transition."),e.outgoing.filter(function(n){return n.guard===t.Transition.FalseGuard}).length>1&&t.console.error(e+": "+e.kind+" pseudo states cannot have more than one Else transitions.")):(0!==e.outgoing.filter(function(n){return n.guard===t.Transition.FalseGuard}).length&&t.console.error(e+": "+e.kind+" pseudo states cannot have Else transitions."),e.isInitial()&&(1!==e.outgoing.length?t.console.error(e+": initial pseudo states must have one outgoing transition."):e.outgoing[0].guard!==t.Transition.TrueGuard&&t.console.error(e+": initial pseudo states cannot have a guard condition.")))},o.prototype.visitRegion=function(e){n.prototype.visitRegion.call(this,e)
var i
e.vertices.forEach(function(n){n instanceof t.PseudoState&&n.isInitial()&&(i&&t.console.error(e+": regions may have at most one initial pseudo state."),i=n)})},o.prototype.visitState=function(e){n.prototype.visitState.call(this,e),e.regions.filter(function(n){return n.name===t.Region.defaultName}).length>1&&t.console.error(e+": a state cannot have more than one region named "+t.Region.defaultName)},o.prototype.visitFinalState=function(e){n.prototype.visitFinalState.call(this,e),0!==e.outgoing.length&&t.console.error(e+": final states must not have outgoing transitions."),0!==e.regions.length&&t.console.error(e+": final states must not have child regions."),0!==e.entryBehavior.length&&t.console.warn(e+": final states may not have entry behavior."),0!==e.exitBehavior.length&&t.console.warn(e+": final states may not have exit behavior.")},o.prototype.visitTransition=function(i){n.prototype.visitTransition.call(this,i),i.kind===t.TransitionKind.Local&&-1===e(i.target).indexOf(i.source)&&t.console.error(i+": local transition target vertices must be a child of the source composite sate.")},o}(t.Visitor)}(e||(e={}))
var n=n
n.exports=e},{}],2:[function(t){!function(n){var e=document.currentScript
if(!e){var i=document.getElementsByTagName("script")
e=i[i.length-1]}n[e.attributes.target?e.attributes.target.textContent:"fsm"]=t("../lib/state.com.js")}(window)},{"../lib/state.com.js":1}]},{},[2])
